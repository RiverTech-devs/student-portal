<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Art Skill Tree Constellation</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(circle, #0a0a2e 0%, #000000 100%);
            font-family: 'Georgia', serif;
            color: #d4af37;
            overflow-x: auto;
            min-height: 100vh;
        }
        
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .container {
            background: rgba(26, 26, 58, 0.9);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
            min-width: 400px;
        }
        
        .title {
            font-size: 28px;
            color: #ffd700;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .subtitle {
            font-size: 16px;
            color: #d4af37;
            margin-bottom: 30px;
            line-height: 1.4;
        }
        
        .input {
            width: 80%;
            padding: 12px;
            background: rgba(15, 15, 42, 0.8);
            border: 2px solid #4a4a6a;
            border-radius: 8px;
            color: #d4af37;
            font-size: 16px;
            text-align: center;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }
        
        .input:focus {
            outline: none;
            border-color: #87ceeb;
            box-shadow: 0 0 10px rgba(135, 206, 235, 0.4);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn {
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid #d4af37;
            color: #d4af37;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Georgia', serif;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .btn:hover {
            background: rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }
        
        .btn.primary {
            background: rgba(135, 206, 235, 0.2);
            border-color: #87ceeb;
            color: #87ceeb;
        }
        
        .btn.primary:hover {
            background: rgba(135, 206, 235, 0.4);
            box-shadow: 0 0 15px rgba(135, 206, 235, 0.5);
        }
        
        .btn.save {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
            color: #4ecdc4;
            padding: 8px 16px;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .btn.save:hover {
            background: rgba(78, 205, 196, 0.4);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }
        
        .error {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 10px;
            display: none;
            padding: 10px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(255, 107, 107, 0.2);
        }
        
        .constellation-container {
            position: absolute;               
            width: 2400px;
            height: 2000px;
            margin: 0;                        
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="star" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:white;stop-opacity:0.8"/><stop offset="100%" style="stop-color:white;stop-opacity:0"/></radialGradient></defs><circle cx="10" cy="20" r="0.5" fill="url(%23star)"/><circle cx="80" cy="15" r="0.3" fill="url(%23star)"/><circle cx="30" cy="60" r="0.4" fill="url(%23star)"/><circle cx="70" cy="80" r="0.2" fill="url(%23star)"/><circle cx="50" cy="30" r="0.3" fill="url(%23star)"/><circle cx="20" cy="85" r="0.4" fill="url(%23star)"/><circle cx="90" cy="50" r="0.2" fill="url(%23star)"/></svg>') repeat;
            background-size: 200px 200px;
            transform-origin: 0 0;            
            will-change: transform;           
        }

        .viewport-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            padding: 10px 16px;
            text-align: center;
            font-weight: 700;
            letter-spacing: .5px;
            background: linear-gradient(180deg, rgba(0,0,0,.85), rgba(0,0,0,0));
            z-index: 1500;
            pointer-events: none;
            user-select: none;
        }


        .viewport {
            position: fixed;
            inset: 0;                
            overflow: hidden;
            z-index: 0;              
        }

        .zoom-controls {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: rgba(0,0,0,0.65);
            border: 1px solid #d4af37;
            border-radius: 10px;
            padding: 8px;
            z-index: 1500;           
        }

        .zoom-btn {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            border: 1px solid #d4af37;
            background: rgba(212,175,55,0.20);
            color: #d4af37;
            font: inherit;
            cursor: pointer;
        }
        .zoom-btn:hover {
            background: rgba(212,175,55,0.35);
        }
        
        .skill-node {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 10;
            user-select: none;
        }
        
        .skill-node.locked {
            background: radial-gradient(circle, #2a2a2a 0%, #1a1a1a 100%);
            border-color: #666;
            color: #666;
            box-shadow: 0 0 5px rgba(100, 100, 100, 0.2);
            cursor: not-allowed;
        }
        
        .skill-node.available {
            background: radial-gradient(circle, #2a2a5a 0%, #1a1a4a 100%);
            border-color: #87ceeb;
            color: #87ceeb;
            box-shadow: 0 0 20px rgba(135, 206, 235, 0.6);
        }
        
        .skill-node.activated {
            background: radial-gradient(circle, #d4af37 0%, #b8860b 100%);
            border-color: #ffd700;
            color: #000;
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.8);
        }
        
        .skill-node.root {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #ffd700 0%, #daa520 100%);
            border: 4px solid #fff;
            font-size: 10px;
            box-shadow: 0 0 35px rgba(255, 215, 0, 0.9);
            color: #000;
        }
        
        .skill-node:hover:not(.locked) {
            transform: scale(1.2);
            z-index: 100;
        }
        
        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.2) 0%, rgba(212, 175, 55, 0.1) 50%, rgba(212, 175, 55, 0.2) 100%);
            transform-origin: left center;
            box-shadow: 0 0 3px rgba(212, 175, 55, 0.2);
            pointer-events: none;
            z-index: 1;
        }
        
        .connection-line.cross {
            height: 1px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 50%, rgba(255, 255, 255, 0.15) 100%);
        }
        
        .connection-line.active {
            height: 4px;
            background: linear-gradient(90deg, #ffd700 0%, #d4af37 50%, #ffd700 100%);
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.9);
            z-index: 3;
        }
        
        .connection-line.cross.active {
            height: 3px;
            background: linear-gradient(90deg, #87ceeb 0%, #4169e1 50%, #87ceeb 100%);
            box-shadow: 0 0 8px rgba(135, 206, 235, 0.7);
        }

        .connection-line,
        .connection-line.highlighted,
        .connection-line.cross,
        .connection-line.cross.highlighted {
            pointer-events: none; /* Always let clicks pass through lines */
        }

        
        .constellation-label {
            position: absolute;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.7);
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.4);
            z-index: 15;
            pointer-events: none;
            user-select: none;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            border: 1px solid #d4af37;
            font-size: 14px;
        }

        .connection-line.highlighted {
            height: 4px;
            background: linear-gradient(90deg, #fff7b3 0%, #ffd700 50%, #fff7b3 100%);
            box-shadow: 0 0 18px rgba(255,215,0,0.95), 0 0 32px rgba(255,215,0,0.45);
            z-index: 4;
        }

        .connection-line.cross.highlighted {
            height: 3px;
            background: linear-gradient(90deg, #e0f1ff 0%, #7db5ff 50%, #e0f1ff 100%);
            box-shadow: 0 0 14px rgba(135,206,235,0.95), 0 0 28px rgba(135,206,235,0.45);
            z-index: 4;
        }

        .dim-lines .connection-line { opacity: 0.18; }
        .dim-lines .connection-line.highlighted { opacity: 1; }

        
        .legend {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 8px;
            z-index: 1000;
            border: 1px solid #d4af37;
            font-size: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .legend-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid;
        }
        
        .legend-circle.activated {
            background: radial-gradient(circle, #d4af37 0%, #b8860b 100%);
            border-color: #ffd700;
        }
        
        .legend-circle.available {
            background: radial-gradient(circle, #2a2a5a 0%, #1a1a4a 100%);
            border-color: #87ceeb;
        }
        
        .legend-circle.locked {
            background: radial-gradient(circle, #2a2a2a 0%, #1a1a1a 100%);
            border-color: #666;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 20000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active { display: flex; }
        
        .code-display {
            background: rgba(15, 15, 42, 0.8);
            border: 2px solid #4a4a6a;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            color: #87ceeb;
            margin: 20px 0;
            letter-spacing: 2px;
            text-align: center;
            word-break: break-all;
        }
        
        .success {
            background: rgba(135, 206, 235, 0.1);
            color: #87ceeb;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(135, 206, 235, 0.3);
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: #d4af37;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 11px;
            border: 1px solid #d4af37;
            pointer-events: none;
            z-index: 1000;
            max-width: 250px;
            text-align: left;
            line-height: 1.3;
            display: none;
        }
        
        .hidden { display: none !important; }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- login removed -->


    <!-- REMOVE this whole block to remove the info box-->
    <div class="controls hidden" id="controls">
        â€¢ Click available nodes to unlock<br>
        â€¢ Scroll to explore constellations<br>
    </div>
    
    <div class="legend hidden" id="legend">
        <div class="legend-item">
            <div class="legend-circle activated"></div>
            <span>Unlocked</span>
        </div>
        <div class="legend-item">
            <div class="legend-circle available"></div>
            <span>Available</span>
        </div>
        <div class="legend-item">
            <div class="legend-circle locked"></div>
            <span>Locked</span>
        </div>
    </div>

    <div class="viewport-header" id="viewportHeader">ðŸŒŸ Art Skill Tree</div>
    
    <div class="viewport hidden" id="viewport">
        <div class="constellation-container" id="constellation">
            <div id="stars"></div>
        </div>
    </div>
    
    <div class="zoom-controls hidden" id="zoomControls">
        <button class="zoom-btn" id="zoomIn">+</button>
        <button class="zoom-btn" id="zoomOut">âˆ’</button>
        <button class="zoom-btn" id="centerView">âŒ‚</button>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <div class="modal" id="saveModal">
        <div class="container">
            <h2 class="title">Your Progress Code</h2>
            <p style="color: #d4af37; margin-bottom: 15px;">Copy this code to restore your progress later:</p>
            <div class="code-display" id="saveCodeDisplay"></div>
            <p style="color: #87ceeb; font-size: 14px; margin: 15px 0;">Keep this code safe! You'll need it to access your progress next time.</p>
            <div class="buttons">
                <button class="btn" id="copyBtn">Copy Code</button>
                <button class="btn" id="closeBtn">Close</button>
            </div>
            <div class="success" id="copySuccess">Code copied to clipboard!</div>
        </div>
    </div>

    <script>
        // === COMPLETE ENHANCED SKILL TREE IMPLEMENTATION ===
        // Replace the entire <script> section in ArtSkillTree.html with this code

        class SkillTreeManager {
            constructor() {
                // Configuration
                this.CHARS = 'ABCDEFGHIJKLMNPQRSTUVWXYZ23456789';
                this.currentSubject = 'Art';
                this.isReadOnly = false;
                
                // State
                this.skillProgress = {};
                this.SKILL_TREE = {};
                this.CONNECTIONS = [];
                this.CONSTELLATION_COLORS = {};
                this.CONSTELLATION_POSITIONS = {};
                this.connectionElements = [];
                this.container = null;
                this.viewport = null;
                
                // Touch and drag state
                this.isDragging = false;
                this.lastTouchTime = 0;
                this.longPressTimer = null;
                this.currentScale = 1;
                this.currentX = 0;
                this.currentY = 0;
                this.startX = 0;
                this.startY = 0;
                this.dragStartX = 0;
                this.dragStartY = 0;
                
                // Mobile detection
                this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                                ('ontouchstart' in window);
                
                this.LONG_PRESS_DURATION = 500;
                
                this.init();
            }

            // === INITIALIZATION ===
            init() {
                // Get subject from URL parameter
                const params = new URLSearchParams(window.location.search);
                this.currentSubject = params.get('subject') || 'Art';
                
                // Update header
                const header = document.getElementById('viewportHeader');
                if (header) {
                    header.textContent = `ðŸŒŸ ${this.currentSubject} Skill Tree`;
                }
                
                // Set up message listeners
                window.addEventListener('message', (event) => this.handleMessage(event));
                
                // Request initial data from parent
                this.requestSkillData();
                
                // Set up UI after short delay
                setTimeout(() => {
                    this.setupUI();
                }, 100);
            }

            // === MESSAGE HANDLING ===
            handleMessage(event) {
                console.log('Skill tree received message:', event.data.type);
                
                switch (event.data.type) {
                    case 'LOAD_SKILL_TREE':
                        this.loadSkillTreeData(event.data);
                        break;
                    case 'SKILL_DATA_RESPONSE':
                        this.loadSkillTreeData(event.data);
                        break;
                    case 'PROGRESS_UPDATED':
                        this.updateProgress(event.data.progress);
                        break;
                }
            }

            requestSkillData() {
                // Request skill tree data from parent
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'REQUEST_SKILL_DATA',
                        subject: this.currentSubject
                    }, '*');
                } else {
                    // Fallback for standalone testing
                    setTimeout(() => {
                        this.loadHardcodedArtData();
                        this.initializeProgress();
                        this.enterApplication();
                    }, 500);
                }
            }

            loadSkillTreeData(data) {
                console.log('Loading skill tree data:', data);
                
                if (data.skillTreeData && data.skillTreeData.skills) {
                    // Load from database format
                    this.SKILL_TREE = data.skillTreeData.skills;
                    this.CONNECTIONS = data.skillTreeData.connections || [];
                    this.CONSTELLATION_COLORS = {};
                    this.CONSTELLATION_POSITIONS = {};
                    
                    // Process constellation data
                    if (data.skillTreeData.constellations) {
                        Object.entries(data.skillTreeData.constellations).forEach(([name, info]) => {
                            this.CONSTELLATION_COLORS[name] = info.color;
                            this.CONSTELLATION_POSITIONS[name] = { x: info.x, y: info.y };
                        });
                    }
                } else {
                    // Fallback to hardcoded data
                    this.loadHardcodedArtData();
                }
                
                // Apply progress
                if (data.progress) {
                    this.applyProgress(data.progress);
                } else {
                    this.initializeProgress();
                }
                
                // Initialize the tree
                this.enterApplication();
            }

            loadHardcodedArtData() {
                // Complete Art skill tree with all nodes
                this.SKILL_TREE = {
                    "Foundational Drawing": { x: 1200, y: 900, type: "root", constellation: "Core", state: "available" },
                    "Line": { x: 1162, y: 463, constellation: "Art Fundamentals", state: "locked" },
                    "Color Theory": { x: 887, y: 939, constellation: "Traditional Media", state: "locked" },
                    "Digital Drawing Tools": { x: 1566, y: 684, constellation: "Digital Art", state: "locked" },
                    "2D Graphic Design": { x: 1260, y: 628, constellation: "Design", state: "locked" },
                    "Animation Basics": { x: 1306, y: 1044, constellation: "Animation", state: "locked" },
                    "AI-Assisted Art": { x: 1070, y: 1007, constellation: "Creative Technology", state: "locked" },
                    "Portfolio Development": { x: 1652, y: 503, constellation: "Professional", state: "locked" },
                    "Scientific Illustration": { x: 862, y: 616, constellation: "Specialized", state: "locked" },
                    "Shape": { x: 1114, y: 374, constellation: "Art Fundamentals", state: "locked" },
                    "Form": { x: 1141, y: 284, constellation: "Art Fundamentals", state: "locked" },
                    "Anatomy": { x: 901, y: 397, constellation: "Art Fundamentals", state: "locked" },
                    "Value & Perspective": { x: 1220, y: 317, constellation: "Art Fundamentals", state: "locked" },
                    "Composition": { x: 1241, y: 412, constellation: "Art Fundamentals", state: "locked" },
                    "Figure Drawing": { x: 1104, y: 637, constellation: "Art Fundamentals", state: "locked" },
                    "Gesture Drawing": { x: 1077, y: 519, constellation: "Art Fundamentals", state: "locked" },
                    "Storytelling": { x: 1329, y: 287, constellation: "Art Fundamentals", state: "locked" },
                    "Color Mixing": { x: 978, y: 852, constellation: "Traditional Media", state: "locked" },
                    "Basic Painting": { x: 967, y: 758, constellation: "Traditional Media", state: "locked" },
                    "Pastels": { x: 721, y: 1101, constellation: "Traditional Media", state: "locked" },
                    "Oil Techniques": { x: 671, y: 821, constellation: "Traditional Media", state: "locked" },
                    "Watercolor": { x: 594, y: 915, constellation: "Traditional Media", state: "locked" },
                    "Acrylic": { x: 768, y: 917, constellation: "Traditional Media", state: "locked" },
                    "Charcoal": { x: 669, y: 693, constellation: "Traditional Media", state: "locked" },
                    "Still Life": { x: 565, y: 748, constellation: "Traditional Media", state: "locked" },
                    "Landscapes": { x: 424, y: 832, constellation: "Traditional Media", state: "locked" },
                    "Portraiture": { x: 490, y: 1041, constellation: "Traditional Media", state: "locked" },
                    "Digital Sketching": { x: 1692, y: 651, constellation: "Digital Art", state: "locked" },
                    "Digital Painting": { x: 1518, y: 779, constellation: "Digital Art", state: "locked" },
                    "Photo Manipulation": { x: 1789, y: 555, constellation: "Digital Art", state: "locked" },
                    "Character Design": { x: 1540, y: 877, constellation: "Digital Art", state: "locked" },
                    "Environment Art": { x: 1659, y: 818, constellation: "Digital Art", state: "locked" },
                    "Speed Painting": { x: 1895, y: 703, constellation: "Digital Art", state: "locked" },
                    "Concept Art": { x: 1592, y: 973, constellation: "Digital Art", state: "locked" },
                    "Digital Illustration": { x: 1715, y: 1062, constellation: "Digital Art", state: "locked" },
                    "Matte Painting": { x: 1769, y: 959, constellation: "Digital Art", state: "locked" },
                    "Texture Painting": { x: 1828, y: 824, constellation: "Digital Art", state: "locked" },
                    "Logo Design": { x: 1337, y: 523, constellation: "Design", state: "locked" },
                    "Typography": { x: 1469, y: 553, constellation: "Design", state: "locked" },
                    "Print Design": { x: 1323, y: 387, constellation: "Design", state: "locked" },
                    "Layout Design": { x: 1409, y: 439, constellation: "Design", state: "locked" },
                    "Branding": { x: 1450, y: 350, constellation: "Design", state: "locked" },
                    "Package Design": { x: 1557, y: 385, constellation: "Design", state: "locked" },
                    "UI/UX Design": { x: 1424, y: 162, constellation: "Design", state: "locked" },
                    "Web Design": { x: 1574, y: 264, constellation: "Design", state: "locked" },
                    "2D Animation": { x: 1448, y: 1007, constellation: "Animation", state: "locked" },
                    "3D Basics": { x: 1211, y: 1115, constellation: "Animation", state: "locked" },
                    "Stop Motion": { x: 1401, y: 1131, constellation: "Animation", state: "locked" },
                    "Motion Graphics": { x: 1358, y: 866, constellation: "Animation", state: "locked" },
                    "Character Animation": { x: 1514, y: 1090, constellation: "Animation", state: "locked" },
                    "Rigging": { x: 1374, y: 1290, constellation: "Animation", state: "locked" },
                    "VFX": { x: 1405, y: 919, constellation: "Animation", state: "locked" },
                    "Compositing": { x: 1541, y: 1214, constellation: "Animation", state: "locked" },
                    "Style Transfer": { x: 992, y: 1160, constellation: "Creative Technology", state: "locked" },
                    "Prompt Crafting": { x: 854, y: 1125, constellation: "Creative Technology", state: "locked" },
                    "Art Ethics": { x: 917, y: 1027, constellation: "Creative Technology", state: "locked" },
                    "Creative Coding": { x: 1091, y: 1122, constellation: "Creative Technology", state: "locked" },
                    "Generative Art": { x: 816, y: 1270, constellation: "Creative Technology", state: "locked" },
                    "Machine Learning": { x: 1074, y: 1250, constellation: "Creative Technology", state: "locked" },
                    "Neural Networks": { x: 950, y: 1328, constellation: "Creative Technology", state: "locked" },
                    "Art Business": { x: 1714, y: 438, constellation: "Professional", state: "locked" },
                    "Teaching Art": { x: 1709, y: 321, constellation: "Professional", state: "locked" },
                    "Freelancing": { x: 1854, y: 467, constellation: "Professional", state: "locked" },
                    "Client Work": { x: 1918, y: 345, constellation: "Professional", state: "locked" },
                    "Art Direction": { x: 2005, y: 275, constellation: "Professional", state: "locked" },
                    "Marketing": { x: 1805, y: 280, constellation: "Professional", state: "locked" },
                    "Art Critique": { x: 1724, y: 188, constellation: "Professional", state: "locked" },
                    "Networking": { x: 2088, y: 482, constellation: "Professional", state: "locked" },
                    "Medical Art": { x: 888, y: 500, constellation: "Specialized", state: "locked" },
                    "Botanical Art": { x: 713, y: 590, constellation: "Specialized", state: "locked" },
                    "Technical Drawing": { x: 766, y: 352, constellation: "Specialized", state: "locked" },
                    "Architectural Rendering": { x: 603, y: 245, constellation: "Specialized", state: "locked" },
                    "Fashion Illustration": { x: 977, y: 644, constellation: "Specialized", state: "locked" }
                };
                
                this.CONNECTIONS = [
                    ["Foundational Drawing", "Line"], ["Foundational Drawing", "Color Theory"],
                    ["Foundational Drawing", "Digital Drawing Tools"], ["Foundational Drawing", "2D Graphic Design"],
                    ["Foundational Drawing", "Animation Basics"], ["Foundational Drawing", "AI-Assisted Art"],
                    ["Foundational Drawing", "Portfolio Development"], ["Foundational Drawing", "Scientific Illustration"],
                    ["Line", "Shape"], ["Line", "Anatomy"], ["Shape", "Form"], ["Anatomy", "Figure Drawing"],
                    ["Figure Drawing", "Gesture Drawing"], ["Shape", "Composition"], ["Form", "Value & Perspective"],
                    ["Value & Perspective", "Storytelling"], ["Composition", "Storytelling"],
                    ["Color Theory", "Color Mixing"], ["Color Mixing", "Basic Painting"],
                    ["Basic Painting", "Oil Techniques"], ["Basic Painting", "Watercolor"], ["Basic Painting", "Acrylic"],
                    ["Oil Techniques", "Still Life"], ["Watercolor", "Landscapes"], ["Acrylic", "Portraiture"],
                    ["Color Theory", "Pastels"], ["Basic Painting", "Charcoal"],
                    ["Digital Drawing Tools", "Digital Sketching"], ["Digital Drawing Tools", "Digital Painting"],
                    ["Digital Painting", "Character Design"], ["Digital Painting", "Environment Art"],
                    ["Character Design", "Concept Art"], ["Digital Sketching", "Photo Manipulation"],
                    ["Concept Art", "Digital Illustration"], ["Environment Art", "Matte Painting"],
                    ["Digital Painting", "Speed Painting"], ["Environment Art", "Texture Painting"],
                    ["2D Graphic Design", "Logo Design"], ["2D Graphic Design", "Typography"],
                    ["Logo Design", "Layout Design"], ["Typography", "Layout Design"],
                    ["Layout Design", "Branding"], ["Layout Design", "Print Design"],
                    ["Branding", "UI/UX Design"], ["UI/UX Design", "Web Design"], ["Branding", "Package Design"],
                    ["Animation Basics", "2D Animation"], ["Animation Basics", "3D Basics"], ["Animation Basics", "Stop Motion"],
                    ["2D Animation", "Character Animation"], ["3D Basics", "Rigging"], ["Animation Basics", "Motion Graphics"],
                    ["Motion Graphics", "VFX"], ["Character Animation", "Compositing"],
                    ["AI-Assisted Art", "Style Transfer"], ["AI-Assisted Art", "Prompt Crafting"], ["AI-Assisted Art", "Art Ethics"],
                    ["Style Transfer", "Generative Art"], ["Prompt Crafting", "Generative Art"], ["AI-Assisted Art", "Creative Coding"],
                    ["Creative Coding", "Machine Learning"], ["Machine Learning", "Neural Networks"],
                    ["Portfolio Development", "Art Business"], ["Art Business", "Freelancing"], ["Art Business", "Teaching Art"],
                    ["Freelancing", "Client Work"], ["Client Work", "Art Direction"], ["Teaching Art", "Art Critique"],
                    ["Art Business", "Marketing"], ["Client Work", "Networking"],
                    ["Scientific Illustration", "Medical Art"], ["Scientific Illustration", "Botanical Art"],
                    ["Scientific Illustration", "Technical Drawing"], ["Technical Drawing", "Architectural Rendering"],
                    ["Figure Drawing", "Fashion Illustration"], ["Figure Drawing", "Character Design"],
                    ["Color Theory", "Digital Painting"], ["Composition", "2D Graphic Design"],
                    ["Digital Painting", "2D Animation"], ["Anatomy", "Medical Art"], ["Technical Drawing", "UI/UX Design"],
                    ["Portfolio Development", "Web Design"], ["Basic Painting", "Digital Painting"],
                    ["Typography", "Motion Graphics"], ["Character Design", "Character Animation"]
                ];
                
                this.CONSTELLATION_COLORS = {
                    "Core": "#ffd700", "Art Fundamentals": "#87ceeb", "Traditional Media": "#dda0dd",
                    "Digital Art": "#98fb98", "Design": "#ffa07a", "Animation": "#20b2aa",
                    "Creative Technology": "#ff6347", "Professional": "#daa520", "Specialized": "#f0e68c"
                };
                
                this.CONSTELLATION_POSITIONS = {
                    "Art Fundamentals": { x: 977, y: 455 }, "Traditional Media": { x: 765, y: 738 },
                    "Digital Art": { x: 1688, y: 752 }, "Design": { x: 1486, y: 458 },
                    "Animation": { x: 1385, y: 1079 }, "Creative Technology": { x: 982, y: 1087 },
                    "Professional": { x: 1762, y: 383 }, "Specialized": { x: 726, y: 484 }
                };
            }

            // === PROGRESS MANAGEMENT ===
            initializeProgress() {
                this.skillProgress = {};
                Object.keys(this.SKILL_TREE).forEach(skill => {
                    this.skillProgress[skill] = this.SKILL_TREE[skill].type === 'root' ? 'available' : 'locked';
                });
            }

            applyProgress(progressObj) {
                if (!progressObj || typeof progressObj !== 'object') return false;

                Object.keys(this.SKILL_TREE).forEach(name => {
                    const state = progressObj[name];
                    const fallback = this.SKILL_TREE[name].type === 'root' ? 'available' : 'locked';
                    this.SKILL_TREE[name].state = (state === 'locked' || state === 'available' || state === 'activated') ? state : fallback;
                });

                this.skillProgress = {};
                Object.keys(this.SKILL_TREE).forEach(name => {
                    this.skillProgress[name] = this.SKILL_TREE[name].state;
                });
                
                return true;
            }

            updateProgress(newProgress) {
                this.applyProgress(newProgress);
                this.refreshAllVisuals();
            }

            // === SKILL LOGIC ===
            getPrerequisites(skillName) {
                return this.CONNECTIONS.filter(([from, to]) => to === skillName).map(([from]) => from);
            }

            getPrerequisiteChain(skillName, visited = new Set()) {
                if (visited.has(skillName)) return [];
                visited.add(skillName);
                
                const directPrereqs = this.getPrerequisites(skillName);
                let chain = [];
                
                directPrereqs.forEach(prereq => {
                    chain = chain.concat(this.getPrerequisiteChain(prereq, visited));
                    if (!chain.includes(prereq)) chain.push(prereq);
                });
                
                return chain;
            }

            canUnlock(skillName) {
                return this.getPrerequisites(skillName).every(prereq => this.SKILL_TREE[prereq].state === 'activated');
            }

            activateSkill(skillName) {
                const skill = this.SKILL_TREE[skillName];
                if (skill.state !== 'available') return;
                
                // Send unlock request to parent
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'SKILL_UNLOCKED',
                        subject: this.currentSubject,
                        skillName: skillName,
                        state: 'activated'
                    }, '*');
                }
                
                // Optimistically update UI
                skill.state = 'activated';
                this.skillProgress[skillName] = 'activated';
                this.updateNodeVisuals(skillName);
                this.updateAvailableSkills();
                this.updateConnections();
            }

            updateAvailableSkills() {
                Object.keys(this.SKILL_TREE).forEach(skillName => {
                    const skill = this.SKILL_TREE[skillName];
                    if (skill.state === 'locked' && this.canUnlock(skillName)) {
                        skill.state = 'available';
                        this.skillProgress[skillName] = 'available';
                        this.updateNodeVisuals(skillName);
                    }
                });
            }

            // === UI SETUP ===
            setupUI() {
                // Show UI elements
                const elements = ['controls', 'legend', 'viewport', 'zoomControls'];
                elements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('hidden');
                });
                
                this.viewport = document.getElementById('viewport');
                this.container = document.getElementById('constellation');
                
                // Reset transform state
                this.currentX = 0;
                this.currentY = 0;
                this.currentScale = 1;
                
                this.setupTouchControls();
                this.setupZoomControls();
            }

            enterApplication() {
                this.hideElement('loginScreen');
                this.showElement('controls');
                this.showElement('legend');
                this.showElement('viewport');
                this.showElement('zoomControls');
                
                this.initializeSkillTree();
                
                setTimeout(() => {
                    this.centerViewport();
                }, 50);
            }

            // === TOUCH AND ZOOM CONTROLS ===
            setupTouchControls() {
                if (!this.viewport || !this.container) return;
                
                // Touch events for dragging
                this.viewport.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: false });
                this.viewport.addEventListener('touchmove', (e) => this.handleTouchMove(e), { passive: false });
                this.viewport.addEventListener('touchend', (e) => this.handleTouchEnd(e), { passive: false });
                
                // Mouse events for desktop
                this.viewport.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                this.viewport.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                this.viewport.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                this.viewport.addEventListener('mouseleave', (e) => this.handleMouseUp(e));
                
                // Prevent context menu
                this.viewport.addEventListener('contextmenu', e => e.preventDefault());
            }

            setupZoomControls() {
                const btnIn = document.getElementById('zoomIn');
                const btnOut = document.getElementById('zoomOut');
                const btnCenter = document.getElementById('centerView');

                btnIn && btnIn.addEventListener('click', () => this.zoom(+1));
                btnOut && btnOut.addEventListener('click', () => this.zoom(-1));
                btnCenter && btnCenter.addEventListener('click', () => this.centerViewport());
            }

            handleTouchStart(e) {
                e.preventDefault();
                if (e.touches.length === 1) {
                    this.startDrag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }
            
            handleTouchMove(e) {
                e.preventDefault();
                if (e.touches.length === 1 && this.isDragging) {
                    this.drag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }
            
            handleTouchEnd(e) {
                e.preventDefault();
                this.endDrag();
            }
            
            handleMouseDown(e) {
                this.startDrag(e.clientX, e.clientY);
            }
            
            handleMouseMove(e) {
                if (this.isDragging) {
                    this.drag(e.clientX, e.clientY);
                }
            }
            
            handleMouseUp(e) {
                this.endDrag();
            }
            
            startDrag(x, y) {
                this.isDragging = true;
                this.startX = x;
                this.startY = y;
                this.dragStartX = this.currentX;
                this.dragStartY = this.currentY;
                this.viewport.classList.add('dragging');
            }
            
            drag(x, y) {
                if (!this.isDragging) return;
                
                const deltaX = x - this.startX;
                const deltaY = y - this.startY;
                
                this.currentX = this.dragStartX + deltaX;
                this.currentY = this.dragStartY + deltaY;
                
                this.updateTransform();
            }
            
            endDrag() {
                this.isDragging = false;
                this.viewport.classList.remove('dragging');
            }

            zoom(direction) {
                if (!this.viewport || !this.container) return;

                const STEP = 1.15;
                const factor = direction > 0 ? STEP : 1 / STEP;

                const vpW = this.viewport.offsetWidth;
                const vpH = this.viewport.offsetHeight;
                const centerX = vpW / 2;
                const centerY = vpH / 2;

                const worldX = (centerX - this.currentX) / this.currentScale;
                const worldY = (centerY - this.currentY) / this.currentScale;

                const newScale = Math.max(0.2, Math.min(2, this.currentScale * factor));
                if (newScale === this.currentScale) return;

                this.currentScale = newScale;

                this.currentX = centerX - worldX * this.currentScale;
                this.currentY = centerY - worldY * this.currentScale;

                this.updateTransform();
            }

            centerViewport() {
                if (!this.viewport || !this.container) return;

                const vpW = this.viewport.offsetWidth;
                const vpH = this.viewport.offsetHeight;

                let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
                Object.values(this.SKILL_TREE).forEach(s => {
                    minX = Math.min(minX, s.x);
                    maxX = Math.max(maxX, s.x);
                    minY = Math.min(minY, s.y);
                    maxY = Math.max(maxY, s.y);
                });
                if (!isFinite(minX) || !isFinite(minY)) return;

                const cx = (minX + maxX) / 2;
                const cy = (minY + maxY) / 2;

                const vpCenterX = vpW / 2;
                const vpCenterY = vpH / 2;
                this.currentX = vpCenterX - (cx * this.currentScale);
                this.currentY = vpCenterY - (cy * this.currentScale);

                this.updateTransform();
            }

            updateTransform() {
                if (!this.container || !this.viewport) return;

                const vpW = this.viewport.offsetWidth;
                const vpH = this.viewport.offsetHeight;
                const worldW = 2400;
                const worldH = 2000;

                const scaledW = worldW * this.currentScale;
                const scaledH = worldH * this.currentScale;

                const overpanX = Math.max(scaledW, vpW) * 0.10;
                const overpanY = Math.max(scaledH, vpH) * 0.10;

                let minX, maxX, minY, maxY;

                if (scaledW >= vpW) {
                    minX = vpW - scaledW - overpanX;
                    maxX = overpanX;
                } else {
                    const centerX = (vpW - scaledW) / 2;
                    minX = centerX - overpanX;
                    maxX = centerX + overpanX;
                }

                if (scaledH >= vpH) {
                    minY = vpH - scaledH - overpanY;
                    maxY = overpanY;
                } else {
                    const centerY = (vpH - scaledH) / 2;
                    minY = centerY - overpanY;
                    maxY = centerY + overpanY;
                }

                this.currentX = Math.max(minX, Math.min(maxX, this.currentX));
                this.currentY = Math.max(minY, Math.min(maxY, this.currentY));

                this.container.style.transform = `translate(${this.currentX}px, ${this.currentY}px) scale(${this.currentScale})`;
            }

            // === SKILL NODE INTERACTION ===
            setupNodeTouchHandling(node, skillName) {
                let touchStartTime = 0;
                let longPressActive = false;
                let touchMoved = false;

                const handleTouchStart = (e) => {
                    e.stopPropagation();
                    touchStartTime = Date.now();
                    longPressActive = false;
                    touchMoved = false;

                    if (this.longPressTimer) clearTimeout(this.longPressTimer);
                    this.longPressTimer = setTimeout(() => {
                        if (!touchMoved && !this.isDragging) {
                            longPressActive = true;
                            this.showTooltipForNode(node, skillName);
                            node.classList.add('highlighted');
                            this.startPathHighlight(skillName);
                            if (navigator.vibrate) navigator.vibrate(50);
                        }
                    }, this.LONG_PRESS_DURATION);
                };

                const handleTouchMove = () => {
                    touchMoved = true;
                    if (this.longPressTimer) {
                        clearTimeout(this.longPressTimer);
                        this.longPressTimer = null;
                    }
                };

                const handleTouchEnd = (e) => {
                    e.stopPropagation();
                    const touchDuration = Date.now() - touchStartTime;
                    if (this.longPressTimer) {
                        clearTimeout(this.longPressTimer);
                        this.longPressTimer = null;
                    }

                    if (longPressActive) {
                        this.hideTooltip();
                        node.classList.remove('highlighted');
                        this.clearPathHighlight();
                        longPressActive = false;
                    } else if (!touchMoved && touchDuration < this.LONG_PRESS_DURATION && !this.isDragging) {
                        const skill = this.SKILL_TREE[skillName];
                        if (skill && skill.state === 'available') this.activateSkill(skillName);
                    }
                    touchMoved = false;
                };

                if (this.isMobile) {
                    node.addEventListener('touchstart', handleTouchStart, { passive: false });
                    node.addEventListener('touchmove', handleTouchMove, { passive: false });
                    node.addEventListener('touchend', handleTouchEnd, { passive: false });
                } else {
                    // Desktop: hover shows glow, click activates
                    node.addEventListener('mouseenter', () => {
                        this.showTooltipForNode(node, skillName);
                        this.startPathHighlight(skillName);
                    });
                    node.addEventListener('mouseleave', () => {
                        this.hideTooltip();
                        node.classList.remove('highlighted');
                        this.clearPathHighlight();
                    });
                    node.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (this.isDragging) return;
                        const skill = this.SKILL_TREE[skillName];
                        if (skill && skill.state === 'available') this.activateSkill(skillName);
                    });
                }
            }

            // === PATH HIGHLIGHTING ===
            startPathHighlight(targetName) {
                if (!this.container || !this.connectionElements) return;

                const chain = new Set(this.getPrerequisiteChain(targetName));
                chain.add(targetName);

                this.container.classList.add('dim-lines');
                this.connectionElements.forEach(line => {
                    const to = line.dataset.to;
                    if (chain.has(to)) {
                        line.classList.add('highlighted');
                    } else {
                        line.classList.remove('highlighted');
                    }
                });
            }

            clearPathHighlight() {
                if (!this.container || !this.connectionElements) return;
                this.container.classList.remove('dim-lines');
                this.connectionElements.forEach(line => line.classList.remove('highlighted'));
            }

            // === TOOLTIP HANDLING ===
            showTooltipForNode(node, skillName) {
                const tooltip = document.getElementById('tooltip');
                if (!tooltip) return;
                
                const prereqs = this.getPrerequisiteChain(skillName);
                const prereqText = prereqs.length > 0 
                    ? '<strong>Prerequisites:</strong><br>' + prereqs.map(p => `â€¢ ${p}`).join('<br>')
                    : '<strong>No prerequisites required</strong>';
                
                tooltip.innerHTML = `<strong>${skillName}</strong><br>${prereqText}`;
                
                const rect = node.getBoundingClientRect();
                const tooltipRect = tooltip.getBoundingClientRect();
                
                let left = rect.left + rect.width / 2 - tooltipRect.width / 2;
                let top = rect.top - tooltipRect.height - 10;
                
                if (left < 10) left = 10;
                if (left + tooltipRect.width > window.innerWidth - 10) {
                    left = window.innerWidth - tooltipRect.width - 10;
                }
                if (top < 10) {
                    top = rect.bottom + 10;
                }
                
                tooltip.style.cssText += `
                    display: block;
                    left: ${left}px;
                    top: ${top}px;
                `;
            }

            hideTooltip() {
                const tooltip = document.getElementById('tooltip');
                if (tooltip) tooltip.style.display = 'none';
            }

            // === RENDERING ===
            createConnectionLine(from, to) {
                const fromSkill = this.SKILL_TREE[from];
                const toSkill = this.SKILL_TREE[to];
                if (!fromSkill || !toSkill) return null;
                
                const line = document.createElement('div');
                const isCross = fromSkill.constellation !== toSkill.constellation;
                line.className = `connection-line ${isCross ? 'cross' : ''}`;
                line.dataset.from = from;
                line.dataset.to = to;
                
                const dx = toSkill.x - fromSkill.x;
                const dy = toSkill.y - fromSkill.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                const nodeOffset = 25;
                
                line.style.cssText += `
                    left: ${fromSkill.x + nodeOffset}px;
                    top: ${fromSkill.y + nodeOffset}px;
                    width: ${length}px;
                    transform: rotate(${angle}deg);
                `;
                
                return line;
            }

            createSkillNode(name, skill) {
                const node = document.createElement('div');
                node.className = `skill-node ${skill.type || ''} ${skill.state}`;
                node.dataset.skillName = name;
                
                let displayText = name;
                if (this.isMobile && name.length > 10) {
                    displayText = name.substring(0, 8) + '...';
                } else if (name.length > 12) {
                    displayText = name.substring(0, 10) + '...';
                }
                node.textContent = displayText;
                
                node.style.cssText = `
                    left: ${skill.x}px;
                    top: ${skill.y}px;
                    border-color: ${this.CONSTELLATION_COLORS[skill.constellation] || '#d4af37'};
                `;
                
                this.setupNodeTouchHandling(node, name);
                
                return node;
            }

            createConstellationLabel(name, pos) {
                const label = document.createElement('div');
                label.className = 'constellation-label';
                label.textContent = name;
                label.style.cssText = `
                    left: ${pos.x}px;
                    top: ${pos.y}px;
                    color: ${this.CONSTELLATION_COLORS[name]};
                `;
                return label;
            }

            createStars() {
                const starsContainer = document.getElementById('stars');
                if (!starsContainer) return;
                
                starsContainer.innerHTML = '';
                const starCount = this.isMobile ? 150 : 300;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.style.cssText = `
                        position: absolute;
                        width: 2px;
                        height: 2px;
                        background: white;
                        border-radius: 50%;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                        opacity: ${0.3 + Math.random() * 0.4};
                        animation: twinkle ${2 + Math.random() * 2}s infinite;
                    `;
                    starsContainer.appendChild(star);
                }
            }

            updateNodeVisuals(skillName) {
                const node = document.querySelector(`[data-skill-name="${skillName}"]`);
                if (node) {
                    const skill = this.SKILL_TREE[skillName];
                    node.className = `skill-node ${skill.type || ''} ${skill.state}`;
                }
            }

            updateConnections() {
                this.connectionElements.forEach(line => {
                    const fromSkill = line.dataset.from;
                    const toSkill = line.dataset.to;
                    const fromActivated = this.SKILL_TREE[fromSkill].state === 'activated';
                    const toActivated = this.SKILL_TREE[toSkill].state === 'activated';
                    
                    if (fromActivated && toActivated) {
                        line.classList.add('active');
                    } else {
                        line.classList.remove('active');
                    }
                });
            }

            refreshAllVisuals() {
                Object.keys(this.SKILL_TREE).forEach(skillName => {
                    this.updateNodeVisuals(skillName);
                });
                this.updateConnections();
            }

            initializeSkillTree() {
                if (!this.container) return;
                
                this.container.innerHTML = '<div id="stars"></div>';
                this.connectionElements = [];
                
                // Create connections
                this.CONNECTIONS.forEach(([from, to]) => {
                    const line = this.createConnectionLine(from, to);
                    if (line) {
                        this.container.appendChild(line);
                        this.connectionElements.push(line);
                    }
                });
                
                // Create constellation labels
                Object.entries(this.CONSTELLATION_POSITIONS).forEach(([name, pos]) => {
                    this.container.appendChild(this.createConstellationLabel(name, pos));
                });
                
                // Create skill nodes
                Object.entries(this.SKILL_TREE).forEach(([name, skill]) => {
                    this.container.appendChild(this.createSkillNode(name, skill));
                });
                
                this.createStars();
                this.updateAvailableSkills();
                this.updateConnections();
            }

            // === UTILITY FUNCTIONS ===
            showElement(id) {
                const el = document.getElementById(id);
                if (el) el.classList.remove('hidden');
            }

            hideElement(id) {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            }
        }

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            window.skillTreeManager = new SkillTreeManager();
            
            // Set up save modal functionality (if needed for standalone testing)
            const saveBtn = document.getElementById('saveBtn');
            const copyBtn = document.getElementById('copyBtn');
            const closeBtn = document.getElementById('closeBtn');
            const saveModal = document.getElementById('saveModal');
            
            if (saveBtn) saveBtn.addEventListener('click', () => generateSaveCode());
            if (copyBtn) copyBtn.addEventListener('click', () => copySaveCode());
            if (closeBtn) closeBtn.addEventListener('click', () => closeSaveModal());
            if (saveModal) {
                saveModal.addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) closeSaveModal();
                });
            }
        });

        // === SAVE/LOAD FUNCTIONS (for standalone testing) ===
        function generateSaveCode() {
            const modal = document.getElementById('saveModal');
            if (modal) modal.classList.add('active');
        }

        function copySaveCode() {
            // Implementation for copying save code
            console.log('Copy save code functionality');
        }

        function closeSaveModal() {
            const modal = document.getElementById('saveModal');
            if (modal) modal.classList.remove('active');
        }
    </script>
</body>

</html>
