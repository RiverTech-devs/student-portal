<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Subject Skill Tree Constellation</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(circle, #0a0a2e 0%, #000000 100%);
            font-family: 'Georgia', serif;
            color: #d4af37;
            overflow-x: auto;
            min-height: 100vh;
        }
        
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .container {
            background: rgba(26, 26, 58, 0.9);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
            min-width: 400px;
        }
        
        .title {
            font-size: 28px;
            color: #ffd700;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .subtitle {
            font-size: 16px;
            color: #d4af37;
            margin-bottom: 30px;
            line-height: 1.4;
        }
        
        .constellation-container {
            position: absolute;               
            width: 2400px;
            height: 2000px;
            margin: 0;                        
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="star" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:white;stop-opacity:0.8"/><stop offset="100%" style="stop-color:white;stop-opacity:0"/></radialGradient></defs><circle cx="10" cy="20" r="0.5" fill="url(%23star)"/><circle cx="80" cy="15" r="0.3" fill="url(%23star)"/><circle cx="30" cy="60" r="0.4" fill="url(%23star)"/><circle cx="70" cy="80" r="0.2" fill="url(%23star)"/><circle cx="50" cy="30" r="0.3" fill="url(%23star)"/><circle cx="20" cy="85" r="0.4" fill="url(%23star)"/><circle cx="90" cy="50" r="0.2" fill="url(%23star)"/></svg>') repeat;
            background-size: 200px 200px;
            transform-origin: 0 0;            
            will-change: transform;           
        }

        .viewport-header {
            position: fixed;
            top: 0; left: 0; right: 0;
            padding: 10px 16px;
            text-align: center;
            font-weight: 700;
            letter-spacing: .5px;
            background: linear-gradient(180deg, rgba(0,0,0,.85), rgba(0,0,0,0));
            z-index: 1500;
            pointer-events: none;
            user-select: none;
        }

        .viewport {
            position: fixed;
            inset: 0;                
            overflow: hidden;
            z-index: 0;              
        }

        .zoom-controls {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: rgba(0,0,0,0.65);
            border: 1px solid #d4af37;
            border-radius: 10px;
            padding: 8px;
            z-index: 1500;           
        }

        .zoom-btn {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            border: 1px solid #d4af37;
            background: rgba(212,175,55,0.20);
            color: #d4af37;
            font: inherit;
            cursor: pointer;
        }
        .zoom-btn:hover {
            background: rgba(212,175,55,0.35);
        }
        
        .skill-node {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 10;
            user-select: none;
        }
        
        .skill-node.locked {
            background: radial-gradient(circle, #2a2a2a 0%, #1a1a1a 100%);
            border-color: #666;
            color: #666;
            box-shadow: 0 0 5px rgba(100, 100, 100, 0.2);
            cursor: not-allowed;
        }
        
        .skill-node.available {
            background: radial-gradient(circle, #2a2a5a 0%, #1a1a4a 100%);
            border-color: #87ceeb;
            color: #87ceeb;
            box-shadow: 0 0 20px rgba(135, 206, 235, 0.6);
        }
        
        .skill-node.activated {
            background: radial-gradient(circle, #d4af37 0%, #b8860b 100%);
            border-color: #ffd700;
            color: #000;
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.8);
        }
        
        .skill-node.root {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #ffd700 0%, #daa520 100%);
            border: 4px solid #fff;
            font-size: 10px;
            box-shadow: 0 0 35px rgba(255, 215, 0, 0.9);
            color: #000;
        }
        
        .skill-node.root.programming {
            background: radial-gradient(circle, #00ff00 0%, #00aa00 100%);
            box-shadow: 0 0 35px rgba(0, 255, 0, 0.9);
        }
        
        .skill-node:hover:not(.locked) {
            transform: scale(1.2);
            z-index: 100;
        }
        
        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.2) 0%, rgba(212, 175, 55, 0.1) 50%, rgba(212, 175, 55, 0.2) 100%);
            transform-origin: left center;
            box-shadow: 0 0 3px rgba(212, 175, 55, 0.2);
            pointer-events: none;
            z-index: 1;
        }
        
        .connection-line.cross {
            height: 1px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.08) 50%, rgba(255, 255, 255, 0.15) 100%);
        }
        
        .connection-line.active {
            height: 4px;
            background: linear-gradient(90deg, #ffd700 0%, #d4af37 50%, #ffd700 100%);
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.9);
            z-index: 3;
        }
        
        .connection-line.cross.active {
            height: 3px;
            background: linear-gradient(90deg, #87ceeb 0%, #4169e1 50%, #87ceeb 100%);
            box-shadow: 0 0 8px rgba(135, 206, 235, 0.7);
        }

        .connection-line,
        .connection-line.highlighted,
        .connection-line.cross,
        .connection-line.cross.highlighted {
            pointer-events: none;
        }
        
        .constellation-label {
            position: absolute;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.7);
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.4);
            z-index: 15;
            pointer-events: none;
            user-select: none;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            border: 1px solid #d4af37;
            font-size: 14px;
        }

        .connection-line.highlighted {
            height: 4px;
            background: linear-gradient(90deg, #fff7b3 0%, #ffd700 50%, #fff7b3 100%);
            box-shadow: 0 0 18px rgba(255,215,0,0.95), 0 0 32px rgba(255,215,0,0.45);
            z-index: 4;
        }

        .connection-line.cross.highlighted {
            height: 3px;
            background: linear-gradient(90deg, #e0f1ff 0%, #7db5ff 50%, #e0f1ff 100%);
            box-shadow: 0 0 14px rgba(135,206,235,0.95), 0 0 28px rgba(135,206,235,0.45);
            z-index: 4;
        }

        .dim-lines .connection-line { opacity: 0.18; }
        .dim-lines .connection-line.highlighted { opacity: 1; }
        
        .legend {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 8px;
            z-index: 1000;
            border: 1px solid #d4af37;
            font-size: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .legend-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid;
        }
        
        .legend-circle.activated {
            background: radial-gradient(circle, #d4af37 0%, #b8860b 100%);
            border-color: #ffd700;
        }
        
        .legend-circle.available {
            background: radial-gradient(circle, #2a2a5a 0%, #1a1a4a 100%);
            border-color: #87ceeb;
        }
        
        .legend-circle.locked {
            background: radial-gradient(circle, #2a2a2a 0%, #1a1a1a 100%);
            border-color: #666;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: #d4af37;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 11px;
            border: 1px solid #d4af37;
            pointer-events: none;
            z-index: 1000;
            max-width: 250px;
            text-align: left;
            line-height: 1.3;
            display: none;
        }
        
        .hidden { display: none !important; }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #0a0a2e 0%, #000000 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20000;
        }

        .loading-content {
            text-align: center;
            color: #d4af37;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(212, 175, 55, 0.2);
            border-top: 3px solid #d4af37;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Loading Skill Tree...</h2>
            <p>Preparing your learning constellation</p>
        </div>
    </div>

    <div class="controls hidden" id="controls">
        â€¢ Click available nodes to unlock<br>
        â€¢ Scroll to explore constellations<br>
    </div>
    
    <div class="legend hidden" id="legend">
        <div class="legend-item">
            <div class="legend-circle activated"></div>
            <span>Unlocked</span>
        </div>
        <div class="legend-item">
            <div class="legend-circle available"></div>
            <span>Available</span>
        </div>
        <div class="legend-item">
            <div class="legend-circle locked"></div>
            <span>Locked</span>
        </div>
    </div>

    <div class="viewport-header" id="viewportHeader">ðŸŒŸ Skill Tree</div>
    
    <div class="viewport hidden" id="viewport">
        <div class="constellation-container" id="constellation">
            <div id="stars"></div>
        </div>
    </div>
    
    <div class="zoom-controls hidden" id="zoomControls">
        <button class="zoom-btn" id="zoomIn">+</button>
        <button class="zoom-btn" id="zoomOut">âˆ’</button>
        <button class="zoom-btn" id="centerView">âŒ‚</button>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        class MultiSubjectSkillTreeManager {
            constructor() {
                // Configuration
                this.CHARS = 'ABCDEFGHIJKLMNPQRSTUVWXYZ23456789';
                this.currentSubject = 'Art';
                this.isReadOnly = false;
                
                // State
                this.skillProgress = {};
                this.SKILL_TREE = {};
                this.CONNECTIONS = [];
                this.CONSTELLATION_COLORS = {};
                this.CONSTELLATION_POSITIONS = {};
                this.connectionElements = [];
                this.container = null;
                this.viewport = null;
                
                // Touch and drag state
                this.isDragging = false;
                this.lastTouchTime = 0;
                this.longPressTimer = null;
                this.currentScale = 1;
                this.currentX = 0;
                this.currentY = 0;
                this.startX = 0;
                this.startY = 0;
                this.dragStartX = 0;
                this.dragStartY = 0;
                
                // Mobile detection
                this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                                ('ontouchstart' in window);
                
                this.LONG_PRESS_DURATION = 500;
                
                this.init();
            }

            // === INITIALIZATION ===
            init() {
                // Get subject from URL parameter
                const params = new URLSearchParams(window.location.search);
                this.currentSubject = params.get('subject') || 'Art';
                
                // Update header
                const header = document.getElementById('viewportHeader');
                if (header) {
                    const emoji = this.getSubjectEmoji(this.currentSubject);
                    header.textContent = `${emoji} ${this.currentSubject} Skill Tree`;
                }
                
                // Set up message listeners
                window.addEventListener('message', (event) => this.handleMessage(event));
                
                // Request initial data from parent
                this.requestSkillData();
                
                // Set up UI after short delay
                setTimeout(() => {
                    this.setupUI();
                }, 100);
            }

            getSubjectEmoji(subject) {
                const emojis = {
                    'Art': 'ðŸŽ¨',
                    'Math': 'ðŸ“',
                    'Science': 'ðŸ”¬',
                    'Reading': 'ðŸ“š',
                    'Programming': 'ðŸ’»',
                    'Robotics': 'ðŸ¤–',
                    'History': 'ðŸ›ï¸',
                    'Music': 'ðŸŽµ',
                    'Physical Education': 'âš½',
                    'Computer Science': 'ðŸ’»'
                };
                return emojis[subject] || 'ðŸŒŸ';
            }

            // === MESSAGE HANDLING ===
            handleMessage(event) {
                console.log('Skill tree received message:', event.data.type);
                
                switch (event.data.type) {
                    case 'LOAD_SKILL_TREE':
                        this.loadSkillTreeData(event.data);
                        break;
                    case 'SKILL_DATA_RESPONSE':
                        this.loadSkillTreeData(event.data);
                        break;
                    case 'PROGRESS_UPDATED':
                        this.updateProgress(event.data.progress);
                        break;
                }
            }

            requestSkillData() {
                // Request skill tree data from parent
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'REQUEST_SKILL_DATA',
                        subject: this.currentSubject
                    }, '*');
                } else {
                    // Fallback for standalone testing
                    setTimeout(() => {
                        this.loadSubjectData(this.currentSubject);
                        this.initializeProgress();
                        this.enterApplication();
                    }, 500);
                }
            }

            loadSkillTreeData(data) {
                console.log('Loading skill tree data:', data);
                
                if (data.skillTreeData && data.skillTreeData.skills) {
                    // Load from database format
                    this.SKILL_TREE = data.skillTreeData.skills;
                    this.CONNECTIONS = data.skillTreeData.connections || [];
                    this.CONSTELLATION_COLORS = {};
                    this.CONSTELLATION_POSITIONS = {};
                    
                    // Process constellation data
                    if (data.skillTreeData.constellations) {
                        Object.entries(data.skillTreeData.constellations).forEach(([name, info]) => {
                            this.CONSTELLATION_COLORS[name] = info.color;
                            this.CONSTELLATION_POSITIONS[name] = { x: info.x, y: info.y };
                        });
                    }
                } else {
                    // Fallback to hardcoded data
                    this.loadSubjectData(this.currentSubject);
                }
                
                // Apply progress
                if (data.progress) {
                    this.applyProgress(data.progress);
                } else {
                    this.initializeProgress();
                }
                
                // Initialize the tree
                this.enterApplication();
            }

            loadSubjectData(subject) {
                const dataLoaders = {
                    'Art': () => this.loadArtData(),
                    'Math': () => this.loadMathData(),
                    'Science': () => this.loadScienceData(),
                    'Reading': () => this.loadReadingData(),
                    'Programming': () => this.loadProgrammingData(),
                    'Robotics': () => this.loadRoboticsData()
                };
                
                const loader = dataLoaders[subject] || dataLoaders['Art'];
                loader();
            }

            loadArtData() {
                // Complete Art skill tree with all nodes
                this.SKILL_TREE = {
                    "Foundational Drawing": { x: 1200, y: 900, type: "root", constellation: "Core", state: "available" },
                    "Line": { x: 1162, y: 463, constellation: "Art Fundamentals", state: "locked" },
                    "Color Theory": { x: 887, y: 939, constellation: "Traditional Media", state: "locked" },
                    "Digital Drawing Tools": { x: 1566, y: 684, constellation: "Digital Art", state: "locked" },
                    "2D Graphic Design": { x: 1260, y: 628, constellation: "Design", state: "locked" },
                    "Animation Basics": { x: 1306, y: 1044, constellation: "Animation", state: "locked" },
                    "AI-Assisted Art": { x: 1070, y: 1007, constellation: "Creative Technology", state: "locked" },
                    "Portfolio Development": { x: 1652, y: 503, constellation: "Professional", state: "locked" },
                    "Scientific Illustration": { x: 862, y: 616, constellation: "Specialized", state: "locked" },
                    "Shape": { x: 1114, y: 374, constellation: "Art Fundamentals", state: "locked" },
                    "Form": { x: 1141, y: 284, constellation: "Art Fundamentals", state: "locked" },
                    "Anatomy": { x: 901, y: 397, constellation: "Art Fundamentals", state: "locked" },
                    "Value & Perspective": { x: 1220, y: 317, constellation: "Art Fundamentals", state: "locked" },
                    "Composition": { x: 1241, y: 412, constellation: "Art Fundamentals", state: "locked" },
                    "Figure Drawing": { x: 1104, y: 637, constellation: "Art Fundamentals", state: "locked" },
                    "Gesture Drawing": { x: 1077, y: 519, constellation: "Art Fundamentals", state: "locked" },
                    "Storytelling": { x: 1329, y: 287, constellation: "Art Fundamentals", state: "locked" },
                    "Color Mixing": { x: 978, y: 852, constellation: "Traditional Media", state: "locked" },
                    "Basic Painting": { x: 967, y: 758, constellation: "Traditional Media", state: "locked" },
                    "Pastels": { x: 721, y: 1101, constellation: "Traditional Media", state: "locked" },
                    "Oil Techniques": { x: 671, y: 821, constellation: "Traditional Media", state: "locked" },
                    "Watercolor": { x: 594, y: 915, constellation: "Traditional Media", state: "locked" },
                    "Acrylic": { x: 768, y: 917, constellation: "Traditional Media", state: "locked" },
                    "Charcoal": { x: 669, y: 693, constellation: "Traditional Media", state: "locked" },
                    "Still Life": { x: 565, y: 748, constellation: "Traditional Media", state: "locked" },
                    "Landscapes": { x: 424, y: 832, constellation: "Traditional Media", state: "locked" },
                    "Portraiture": { x: 490, y: 1041, constellation: "Traditional Media", state: "locked" },
                    "Digital Sketching": { x: 1692, y: 651, constellation: "Digital Art", state: "locked" },
                    "Digital Painting": { x: 1518, y: 779, constellation: "Digital Art", state: "locked" },
                    "Photo Manipulation": { x: 1789, y: 555, constellation: "Digital Art", state: "locked" },
                    "Character Design": { x: 1540, y: 877, constellation: "Digital Art", state: "locked" },
                    "Environment Art": { x: 1659, y: 818, constellation: "Digital Art", state: "locked" },
                    "Speed Painting": { x: 1895, y: 703, constellation: "Digital Art", state: "locked" },
                    "Concept Art": { x: 1592, y: 973, constellation: "Digital Art", state: "locked" },
                    "Digital Illustration": { x: 1715, y: 1062, constellation: "Digital Art", state: "locked" },
                    "Matte Painting": { x: 1769, y: 959, constellation: "Digital Art", state: "locked" },
                    "Texture Painting": { x: 1828, y: 824, constellation: "Digital Art", state: "locked" },
                    "Logo Design": { x: 1337, y: 523, constellation: "Design", state: "locked" },
                    "Typography": { x: 1469, y: 553, constellation: "Design", state: "locked" },
                    "Print Design": { x: 1323, y: 387, constellation: "Design", state: "locked" },
                    "Layout Design": { x: 1409, y: 439, constellation: "Design", state: "locked" },
                    "Branding": { x: 1450, y: 350, constellation: "Design", state: "locked" },
                    "Package Design": { x: 1557, y: 385, constellation: "Design", state: "locked" },
                    "UI/UX Design": { x: 1424, y: 162, constellation: "Design", state: "locked" },
                    "Web Design": { x: 1574, y: 264, constellation: "Design", state: "locked" },
                    "2D Animation": { x: 1448, y: 1007, constellation: "Animation", state: "locked" },
                    "3D Basics": { x: 1211, y: 1115, constellation: "Animation", state: "locked" },
                    "Stop Motion": { x: 1401, y: 1131, constellation: "Animation", state: "locked" },
                    "Motion Graphics": { x: 1358, y: 866, constellation: "Animation", state: "locked" },
                    "Character Animation": { x: 1514, y: 1090, constellation: "Animation", state: "locked" },
                    "Rigging": { x: 1374, y: 1290, constellation: "Animation", state: "locked" },
                    "VFX": { x: 1405, y: 919, constellation: "Animation", state: "locked" },
                    "Compositing": { x: 1541, y: 1214, constellation: "Animation", state: "locked" },
                    "Style Transfer": { x: 992, y: 1160, constellation: "Creative Technology", state: "locked" },
                    "Prompt Crafting": { x: 854, y: 1125, constellation: "Creative Technology", state: "locked" },
                    "Art Ethics": { x: 917, y: 1027, constellation: "Creative Technology", state: "locked" },
                    "Creative Coding": { x: 1091, y: 1122, constellation: "Creative Technology", state: "locked" },
                    "Generative Art": { x: 816, y: 1270, constellation: "Creative Technology", state: "locked" },
                    "Machine Learning": { x: 1074, y: 1250, constellation: "Creative Technology", state: "locked" },
                    "Neural Networks": { x: 950, y: 1328, constellation: "Creative Technology", state: "locked" },
                    "Art Business": { x: 1714, y: 438, constellation: "Professional", state: "locked" },
                    "Teaching Art": { x: 1709, y: 321, constellation: "Professional", state: "locked" },
                    "Freelancing": { x: 1854, y: 467, constellation: "Professional", state: "locked" },
                    "Client Work": { x: 1918, y: 345, constellation: "Professional", state: "locked" },
                    "Art Direction": { x: 2005, y: 275, constellation: "Professional", state: "locked" },
                    "Marketing": { x: 1805, y: 280, constellation: "Professional", state: "locked" },
                    "Art Critique": { x: 1724, y: 188, constellation: "Professional", state: "locked" },
                    "Networking": { x: 2088, y: 482, constellation: "Professional", state: "locked" },
                    "Medical Art": { x: 888, y: 500, constellation: "Specialized", state: "locked" },
                    "Botanical Art": { x: 713, y: 590, constellation: "Specialized", state: "locked" },
                    "Technical Drawing": { x: 766, y: 352, constellation: "Specialized", state: "locked" },
                    "Architectural Rendering": { x: 603, y: 245, constellation: "Specialized", state: "locked" },
                    "Fashion Illustration": { x: 977, y: 644, constellation: "Specialized", state: "locked" }
                };
                
                this.CONNECTIONS = [
                    ["Foundational Drawing", "Line"], ["Foundational Drawing", "Color Theory"],
                    ["Foundational Drawing", "Digital Drawing Tools"], ["Foundational Drawing", "2D Graphic Design"],
                    ["Foundational Drawing", "Animation Basics"], ["Foundational Drawing", "AI-Assisted Art"],
                    ["Foundational Drawing", "Portfolio Development"], ["Foundational Drawing", "Scientific Illustration"],
                    ["Line", "Shape"], ["Line", "Anatomy"], ["Shape", "Form"], ["Anatomy", "Figure Drawing"],
                    ["Figure Drawing", "Gesture Drawing"], ["Shape", "Composition"], ["Form", "Value & Perspective"],
                    ["Value & Perspective", "Storytelling"], ["Composition", "Storytelling"],
                    ["Color Theory", "Color Mixing"], ["Color Mixing", "Basic Painting"],
                    ["Basic Painting", "Oil Techniques"], ["Basic Painting", "Watercolor"], ["Basic Painting", "Acrylic"],
                    ["Oil Techniques", "Still Life"], ["Watercolor", "Landscapes"], ["Acrylic", "Portraiture"],
                    ["Color Theory", "Pastels"], ["Basic Painting", "Charcoal"],
                    ["Digital Drawing Tools", "Digital Sketching"], ["Digital Drawing Tools", "Digital Painting"],
                    ["Digital Painting", "Character Design"], ["Digital Painting", "Environment Art"],
                    ["Character Design", "Concept Art"], ["Digital Sketching", "Photo Manipulation"],
                    ["Concept Art", "Digital Illustration"], ["Environment Art", "Matte Painting"],
                    ["Digital Painting", "Speed Painting"], ["Environment Art", "Texture Painting"],
                    ["2D Graphic Design", "Logo Design"], ["2D Graphic Design", "Typography"],
                    ["Logo Design", "Layout Design"], ["Typography", "Layout Design"],
                    ["Layout Design", "Branding"], ["Layout Design", "Print Design"],
                    ["Branding", "UI/UX Design"], ["UI/UX Design", "Web Design"], ["Branding", "Package Design"],
                    ["Animation Basics", "2D Animation"], ["Animation Basics", "3D Basics"], ["Animation Basics", "Stop Motion"],
                    ["2D Animation", "Character Animation"], ["3D Basics", "Rigging"], ["Animation Basics", "Motion Graphics"],
                    ["Motion Graphics", "VFX"], ["Character Animation", "Compositing"],
                    ["AI-Assisted Art", "Style Transfer"], ["AI-Assisted Art", "Prompt Crafting"], ["AI-Assisted Art", "Art Ethics"],
                    ["Style Transfer", "Generative Art"], ["Prompt Crafting", "Generative Art"], ["AI-Assisted Art", "Creative Coding"],
                    ["Creative Coding", "Machine Learning"], ["Machine Learning", "Neural Networks"],
                    ["Portfolio Development", "Art Business"], ["Art Business", "Freelancing"], ["Art Business", "Teaching Art"],
                    ["Freelancing", "Client Work"], ["Client Work", "Art Direction"], ["Teaching Art", "Art Critique"],
                    ["Art Business", "Marketing"], ["Client Work", "Networking"],
                    ["Scientific Illustration", "Medical Art"], ["Scientific Illustration", "Botanical Art"],
                    ["Scientific Illustration", "Technical Drawing"], ["Technical Drawing", "Architectural Rendering"],
                    ["Figure Drawing", "Fashion Illustration"], ["Figure Drawing", "Character Design"],
                    ["Color Theory", "Digital Painting"], ["Composition", "2D Graphic Design"],
                    ["Digital Painting", "2D Animation"], ["Anatomy", "Medical Art"], ["Technical Drawing", "UI/UX Design"],
                    ["Portfolio Development", "Web Design"], ["Basic Painting", "Digital Painting"],
                    ["Typography", "Motion Graphics"], ["Character Design", "Character Animation"]
                ];
                
                this.CONSTELLATION_COLORS = {
                    "Core": "#ffd700", "Art Fundamentals": "#87ceeb", "Traditional Media": "#dda0dd",
                    "Digital Art": "#98fb98", "Design": "#ffa07a", "Animation": "#20b2aa",
                    "Creative Technology": "#ff6347", "Professional": "#daa520", "Specialized": "#f0e68c"
                };
                
                this.CONSTELLATION_POSITIONS = {
                    "Art Fundamentals": { x: 977, y: 455 }, "Traditional Media": { x: 765, y: 738 },
                    "Digital Art": { x: 1688, y: 752 }, "Design": { x: 1486, y: 458 },
                    "Animation": { x: 1385, y: 1079 }, "Creative Technology": { x: 982, y: 1087 },
                    "Professional": { x: 1762, y: 383 }, "Specialized": { x: 726, y: 484 }
                };
            }

            loadMathData() {
                // Adapted from the math skill tree data
                this.SKILL_TREE = {
                    "Counting and Number Recognition": { x: 1213, y: 2837, type: "root", constellation: "Basic Arithmetic", state: "activated" },
                    "Place Value Understanding": { x: 1258, y: 2705, constellation: "Basic Arithmetic", state: "activated" },
                    "Basic Addition": { x: 1399, y: 2526, constellation: "Basic Arithmetic", state: "activated" },
                    "Basic Subtraction": { x: 1109, y: 2512, constellation: "Basic Arithmetic", state: "activated" },
                    "Multiplication": { x: 1198, y: 2377, constellation: "Intermediate Arithmetic", state: "activated" },
                    "Division": { x: 1446, y: 2251, constellation: "Intermediate Arithmetic", state: "activated" },
                    "Basic Fractions": { x: 1078, y: 2106, constellation: "Intermediate Arithmetic", state: "activated" },
                    "Negatives": { x: 617, y: 1920, constellation: "Advanced Arithmetic", state: "activated" },
                    "Advanced Fractions": { x: 524, y: 1730, constellation: "Advanced Arithmetic", state: "activated" },
                    "Basic Geometry Concepts": { x: 1629, y: 1717, constellation: "Advanced Arithmetic", state: "activated" },
                    "Decimals": { x: 949, y: 1774, constellation: "Advanced Arithmetic", state: "activated" },
                    "Percentages": { x: 1099, y: 1702, constellation: "Advanced Arithmetic", state: "activated" },
                    "Basic Algebraic Expressions": { x: 961, y: 1458, constellation: "Pre-Algebra", state: "activated" },
                    "Ratio and Proportion": { x: 1179, y: 1432, constellation: "Pre-Algebra", state: "activated" },
                    "Basic Graphing": { x: 448, y: 1405, constellation: "Pre-Algebra", state: "activated" },
                    "Solving Simple Equations": { x: 767, y: 1386, constellation: "Pre-Algebra", state: "activated" },
                    "Angles and Lines": { x: 1745, y: 1175, constellation: "Geometry", state: "activated" },
                    "Transformations": { x: 1600, y: 1400, constellation: "Geometry", state: "activated" },
                    "Triangles and Pythagorean Theorem": { x: 1875, y: 927, constellation: "Geometry", state: "activated" },
                    "Area and Perimeter": { x: 1500, y: 1100, constellation: "Geometry", state: "activated" },
                    "Circles": { x: 1851, y: 777, constellation: "Geometry", state: "activated" },
                    "Volume": { x: 1500, y: 950, constellation: "Geometry", state: "activated" },
                    "Polynomials": { x: 509, y: 1186, constellation: "Algebra 1", state: "activated" },
                    "Linear Equations": { x: 849, y: 1272, constellation: "Algebra 1", state: "activated" },
                    "Inequalities": { x: 821, y: 1084, constellation: "Algebra 1", state: "activated" },
                    "Factoring": { x: 679, y: 1048, constellation: "Algebra 1", state: "activated" },
                    "Basic Functions": { x: 1054, y: 1146, constellation: "Algebra 1", state: "activated" },
                    "Quadratic Equations": { x: 490, y: 961, constellation: "Algebra 1", state: "activated" },
                    "Complex Numbers": { x: 643, y: 767, constellation: "Algebra 2", state: "activated" },
                    "Advanced Polynomials": { x: 754, y: 778, constellation: "Algebra 2", state: "activated" },
                    "Exponential and Logarithmic Functions": { x: 956, y: 857, constellation: "Algebra 2", state: "activated" },
                    "Rational Functions": { x: 1061, y: 964, constellation: "Algebra 2", state: "activated" },
                    "Sequence and Series": { x: 1204, y: 910, constellation: "Algebra 2", state: "activated" },
                    "Conic Sections": { x: 1068, y: 642, constellation: "Pre-Calculus", state: "activated" },
                    "Trigonometry": { x: 1660, y: 479, constellation: "Pre-Calculus", state: "activated" },
                    "Matrices": { x: 824, y: 452, constellation: "Pre-Calculus", state: "activated" },
                    "Advanced Functions": { x: 1116, y: 516, constellation: "Pre-Calculus", state: "activated" },
                    "Vectors": { x: 1367, y: 363, constellation: "Pre-Calculus", state: "activated" },
                    "Limits": { x: 1091, y: 316, constellation: "Calculus", state: "activated" },
                    "Derivatives": { x: 1175, y: 234, constellation: "Calculus", state: "activated" },
                    "Integrals": { x: 1071, y: 144, constellation: "Calculus", state: "activated" },
                    "Multivariable Calculus": { x: 1144, y: 65, constellation: "Calculus", state: "activated" },
                    "Differential Equations": { x: 910, y: 20, constellation: "Calculus", state: "activated" },
                    "Probability and Statistics": { x: 298, y: 287, constellation: "Advanced Mathematics", state: "activated" },
                    "Linear Algebra": { x: 462, y: 389, constellation: "Advanced Mathematics", state: "activated" },
                    "Real Analysis": { x: 678, y: 248, constellation: "Advanced Mathematics", state: "activated" },
                    "Complex Analysis": { x: 619, y: 327, constellation: "Advanced Mathematics", state: "activated" },
                    "Abstract Algebra": { x: 185, y: 236, constellation: "Specialized Topics", state: "activated" },
                    "Number Theory": { x: -119, y: 165, constellation: "Specialized Topics", state: "activated" },
                    "Discrete Mathematics": { x: 7, y: 218, constellation: "Specialized Topics", state: "activated" },
                    "Advanced Number Theory": { x: -226, y: 259, constellation: "Specialized Topics", state: "activated" },
                    "Mathematical Logic": { x: 37, y: 15, constellation: "Specialized Topics", state: "activated" },
                    "Mathematical Research Techniques": { x: 358, y: 62, constellation: "Mastery and Research", state: "activated" },
                    "Applied Mathematics": { x: 464, y: 121, constellation: "Mastery and Research", state: "activated" },
                    "Theoretical Mathematics": { x: 372, y: 215, constellation: "Mastery and Research", state: "activated" },
                    "Advanced Computational Methods": { x: 292, y: -95, constellation: "Mastery and Research", state: "activated" },
                    "Differential Geometry": { x: 527, y: -16, constellation: "Final Specializations", state: "activated" },
                    "Topology": { x: 654, y: 135, constellation: "Final Specializations", state: "activated" },
                    "Advanced Statistics": { x: 664, y: -194, constellation: "Final Specializations", state: "activated" }
                };
        
                this.CONNECTIONS = [
                    ["Counting and Number Recognition", "Place Value Understanding"],
                    ["Place Value Understanding", "Basic Addition"],
                    ["Place Value Understanding", "Basic Subtraction"],
                    ["Basic Addition", "Multiplication"],
                    ["Basic Subtraction", "Multiplication"],
                    ["Multiplication", "Division"],
                    ["Multiplication", "Basic Fractions"],
                    ["Division", "Basic Fractions"],
                    ["Basic Subtraction", "Negatives"],
                    ["Basic Fractions", "Advanced Fractions"],
                    ["Basic Fractions", "Basic Geometry Concepts"],
                    ["Advanced Fractions", "Decimals"],
                    ["Decimals", "Percentages"],
                    ["Percentages", "Basic Algebraic Expressions"],
                    ["Percentages", "Ratio and Proportion"],
                    ["Percentages", "Basic Graphing"],
                    ["Basic Algebraic Expressions", "Solving Simple Equations"],
                    ["Basic Geometry Concepts", "Angles and Lines"],
                    ["Basic Geometry Concepts", "Transformations"],
                    ["Angles and Lines", "Triangles and Pythagorean Theorem"],
                    ["Triangles and Pythagorean Theorem", "Circles"],
                    ["Angles and Lines", "Area and Perimeter"],
                    ["Area and Perimeter", "Volume"],
                    ["Solving Simple Equations", "Polynomials"],
                    ["Solving Simple Equations", "Linear Equations"],
                    ["Linear Equations", "Inequalities"],
                    ["Linear Equations", "Basic Functions"],
                    ["Polynomials", "Factoring"],
                    ["Factoring", "Quadratic Equations"],
                    ["Quadratic Equations", "Complex Numbers"],
                    ["Factoring", "Advanced Polynomials"],
                    ["Basic Functions", "Exponential and Logarithmic Functions"],
                    ["Basic Functions", "Rational Functions"],
                    ["Basic Functions", "Sequence and Series"],
                    ["Exponential and Logarithmic Functions", "Conic Sections"],
                    ["Triangles and Pythagorean Theorem", "Trigonometry"],
                    ["Complex Numbers", "Matrices"],
                    ["Advanced Polynomials", "Advanced Functions"],
                    ["Trigonometry", "Vectors"],
                    ["Advanced Functions", "Limits"],
                    ["Matrices", "Limits"],
                    ["Vectors", "Limits"],
                    ["Limits", "Derivatives"],
                    ["Derivatives", "Integrals"],
                    ["Integrals", "Multivariable Calculus"],
                    ["Integrals", "Differential Equations"],
                    ["Basic Graphing", "Probability and Statistics"],
                    ["Matrices", "Linear Algebra"],
                    ["Integrals", "Real Analysis"],
                    ["Real Analysis", "Complex Analysis"],
                    ["Advanced Polynomials", "Abstract Algebra"],
                    ["Advanced Fractions", "Number Theory"],
                    ["Basic Graphing", "Discrete Mathematics"],
                    ["Number Theory", "Advanced Number Theory"],
                    ["Discrete Mathematics", "Mathematical Logic"],
                    ["Differential Equations", "Applied Mathematics"],
                    ["Abstract Algebra", "Theoretical Mathematics"],
                    ["Real Analysis", "Theoretical Mathematics"],
                    ["Complex Analysis", "Theoretical Mathematics"],
                    ["Discrete Mathematics", "Advanced Computational Methods"],
                    ["Probability and Statistics", "Advanced Computational Methods"],
                    ["Applied Mathematics", "Mathematical Research Techniques"],
                    ["Theoretical Mathematics", "Mathematical Research Techniques"],
                    ["Advanced Computational Methods", "Mathematical Research Techniques"],
                    ["Mathematical Research Techniques", "Differential Geometry"],
                    ["Theoretical Mathematics", "Topology"],
                    ["Advanced Computational Methods", "Advanced Statistics"]
                ];
        
                this.CONSTELLATION_COLORS = {
                    "Basic Arithmetic": "#ffd700",
                    "Intermediate Arithmetic": "#87ceeb", 
                    "Advanced Arithmetic": "#dda0dd",
                    "Pre-Algebra": "#98fb98",
                    "Geometry": "#ffa07a",
                    "Algebra 1": "#20b2aa",
                    "Algebra 2": "#ff6347",
                    "Pre-Calculus": "#daa520",
                    "Calculus": "#f0e68c",
                    "Advanced Mathematics": "#9370db",
                    "Specialized Topics": "#32cd32",
                    "Mastery and Research": "#ff69b4",
                    "Final Specializations": "#00ced1"
                };
        
                this.CONSTELLATION_POSITIONS = {
                    "Basic Arithmetic": { x: 1197, y: 2555 },
                    "Intermediate Arithmetic": { x: 1169, y: 2222 },
                    "Advanced Arithmetic": { x: 1068, y: 1803 },
                    "Pre-Algebra": { x: 1000, y: 1400 },
                    "Geometry": { x: 1671, y: 1053 },
                    "Algebra 1": { x: 800, y: 1100 },
                    "Algebra 2": { x: 1047, y: 875 },
                    "Pre-Calculus": { x: 959, y: 476 },
                    "Calculus": { x: 1026, y: 224 },
                    "Advanced Mathematics": { x: 400, y: 296 },
                    "Specialized Topics": { x: -191, y: 97 },
                    "Mastery and Research": { x: 186, y: -145 },
                    "Final Specializations": { x: 640, y: -11 }
                };
            }
        
            loadScienceData() {
                this.SKILL_TREE = {
                    "Scientific Method": { x: 1200, y: 900, type: "root", constellation: "Core Science", state: "available" },
                    "Observation Skills": { x: 1162, y: 763, constellation: "Scientific Thinking", state: "locked" },
                    "Hypothesis Formation": { x: 1087, y: 639, constellation: "Scientific Thinking", state: "locked" },
                    "Data Collection": { x: 1266, y: 684, constellation: "Scientific Thinking", state: "locked" },
                    "Basic Chemistry": { x: 887, y: 939, constellation: "Physical Science", state: "locked" },
                    "States of Matter": { x: 778, y: 852, constellation: "Physical Science", state: "locked" },
                    "Chemical Reactions": { x: 967, y: 758, constellation: "Physical Science", state: "locked" },
                    "Atoms and Molecules": { x: 721, y: 701, constellation: "Physical Science", state: "locked" },
                    "Forces and Motion": { x: 1566, y: 684, constellation: "Physics", state: "locked" },
                    "Energy Types": { x: 1692, y: 651, constellation: "Physics", state: "locked" },
                    "Simple Machines": { x: 1518, y: 779, constellation: "Physics", state: "locked" },
                    "Magnetism": { x: 1659, y: 818, constellation: "Physics", state: "locked" },
                    "Plant Biology": { x: 1260, y: 1128, constellation: "Life Science", state: "locked" },
                    "Animal Biology": { x: 1306, y: 1244, constellation: "Life Science", state: "locked" },
                    "Ecosystems": { x: 1448, y: 1307, constellation: "Life Science", state: "locked" },
                    "Human Body": { x: 1211, y: 1415, constellation: "Life Science", state: "locked" },
                    "Weather Patterns": { x: 862, y: 616, constellation: "Earth Science", state: "locked" },
                    "Rock Cycle": { x: 713, y: 590, constellation: "Earth Science", state: "locked" },
                    "Solar System": { x: 766, y: 452, constellation: "Earth Science", state: "locked" },
                    "Climate Change": { x: 603, y: 545, constellation: "Earth Science", state: "locked" }
                };

                this.CONNECTIONS = [
                    ["Scientific Method", "Observation Skills"],
                    ["Scientific Method", "Basic Chemistry"],
                    ["Scientific Method", "Forces and Motion"],
                    ["Scientific Method", "Plant Biology"],
                    ["Scientific Method", "Weather Patterns"],
                    ["Observation Skills", "Hypothesis Formation"],
                    ["Observation Skills", "Data Collection"],
                    ["Basic Chemistry", "States of Matter"],
                    ["States of Matter", "Chemical Reactions"],
                    ["Chemical Reactions", "Atoms and Molecules"],
                    ["Forces and Motion", "Energy Types"],
                    ["Energy Types", "Simple Machines"],
                    ["Simple Machines", "Magnetism"],
                    ["Plant Biology", "Animal Biology"],
                    ["Animal Biology", "Ecosystems"],
                    ["Ecosystems", "Human Body"],
                    ["Weather Patterns", "Rock Cycle"],
                    ["Rock Cycle", "Solar System"],
                    ["Solar System", "Climate Change"]
                ];

                this.CONSTELLATION_COLORS = {
                    "Core Science": "#ffd700",
                    "Scientific Thinking": "#87ceeb",
                    "Physical Science": "#dda0dd",
                    "Physics": "#98fb98",
                    "Life Science": "#ffa07a",
                    "Earth Science": "#20b2aa"
                };

                this.CONSTELLATION_POSITIONS = {
                    "Scientific Thinking": { x: 1177, y: 655 },
                    "Physical Science": { x: 865, y: 838 },
                    "Physics": { x: 1588, y: 752 },
                    "Life Science": { x: 1285, y: 1279 },
                    "Earth Science": { x: 726, y: 484 }
                };
            }

            loadReadingData() {
                this.SKILL_TREE = {
                    "Letter Recognition": { x: 1200, y: 1500, type: "root", constellation: "Reading Foundations", state: "available" },
                    "Phonics": { x: 1162, y: 1363, constellation: "Reading Foundations", state: "locked" },
                    "Sight Words": { x: 1087, y: 1239, constellation: "Reading Foundations", state: "locked" },
                    "Decoding": { x: 1266, y: 1284, constellation: "Reading Foundations", state: "locked" },
                    "Fluency": { x: 1200, y: 1100, constellation: "Reading Skills", state: "locked" },
                    "Vocabulary": { x: 1087, y: 939, constellation: "Reading Skills", state: "locked" },
                    "Reading Comprehension": { x: 1300, y: 800, constellation: "Reading Skills", state: "locked" },
                    "Main Ideas": { x: 1162, y: 663, constellation: "Comprehension", state: "locked" },
                    "Supporting Details": { x: 1087, y: 539, constellation: "Comprehension", state: "locked" },
                    "Inferences": { x: 1366, y: 584, constellation: "Comprehension", state: "locked" },
                    "Cause and Effect": { x: 1266, y: 484, constellation: "Comprehension", state: "locked" },
                    "Fiction Elements": { x: 887, y: 739, constellation: "Literary Analysis", state: "locked" },
                    "Character Analysis": { x: 778, y: 652, constellation: "Literary Analysis", state: "locked" },
                    "Plot Structure": { x: 967, y: 558, constellation: "Literary Analysis", state: "locked" },
                    "Theme": { x: 821, y: 501, constellation: "Literary Analysis", state: "locked" },
                    "Poetry Analysis": { x: 1566, y: 284, constellation: "Advanced Reading", state: "locked" },
                    "Text Features": { x: 1692, y: 351, constellation: "Advanced Reading", state: "locked" },
                    "Research Skills": { x: 1518, y: 179, constellation: "Advanced Reading", state: "locked" },
                    "Critical Thinking": { x: 1659, y: 118, constellation: "Advanced Reading", state: "locked" }
                };

                this.CONNECTIONS = [
                    ["Letter Recognition", "Phonics"],
                    ["Letter Recognition", "Sight Words"],
                    ["Phonics", "Decoding"],
                    ["Sight Words", "Decoding"],
                    ["Decoding", "Fluency"],
                    ["Fluency", "Vocabulary"],
                    ["Vocabulary", "Reading Comprehension"],
                    ["Reading Comprehension", "Main Ideas"],
                    ["Main Ideas", "Supporting Details"],
                    ["Main Ideas", "Inferences"],
                    ["Supporting Details", "Cause and Effect"],
                    ["Inferences", "Cause and Effect"],
                    ["Reading Comprehension", "Fiction Elements"],
                    ["Fiction Elements", "Character Analysis"],
                    ["Character Analysis", "Plot Structure"],
                    ["Plot Structure", "Theme"],
                    ["Cause and Effect", "Poetry Analysis"],
                    ["Inferences", "Text Features"],
                    ["Poetry Analysis", "Research Skills"],
                    ["Text Features", "Critical Thinking"]
                ];

                this.CONSTELLATION_COLORS = {
                    "Reading Foundations": "#ffd700",
                    "Reading Skills": "#87ceeb",
                    "Comprehension": "#dda0dd",
                    "Literary Analysis": "#98fb98",
                    "Advanced Reading": "#ffa07a"
                };

                this.CONSTELLATION_POSITIONS = {
                    "Reading Foundations": { x: 1177, y: 1355 },
                    "Reading Skills": { x: 1200, y: 950 },
                    "Comprehension": { x: 1266, y: 555 },
                    "Literary Analysis": { x: 865, y: 638 },
                    "Advanced Reading": { x: 1588, y: 252 }
                };
            }

            loadProgrammingData() {
                // Comprehensive Programming skill tree
                this.SKILL_TREE = {
                    "Introduction to Operating Systems": { x: 1033, y: 3290, type: "root", constellation: "Core Foundations", state: "available" },
                    "Basic Computer Operations": { x: 1307, y: 3444, type: "root", constellation: "Core Foundations", state: "available" },
                    "Basic Arithmetic": { x: 1547, y: 3387, type: "root", constellation: "Core Foundations", state: "available" },
                    "Basic Software Tools": { x: 797, y: 2899, constellation: "Basic Programming", state: "locked" },
                    "Programming/Basic Theory": { x: 1426, y: 2948, constellation: "Basic Programming", state: "locked" },
                    "Text Manipulation": { x: 1545, y: 2888, constellation: "Basic Programming", state: "locked" },
                    "Basic Database Concepts": { x: 1046, y: 2577, constellation: "Intermediate Programming", state: "locked" },
                    "Markup Languages": { x: 1136, y: 2510, constellation: "Intermediate Programming", state: "locked" },
                    "Object Oriented Programming": { x: 1489, y: 2721, constellation: "Intermediate Programming", state: "locked" },
                    "Computer Science Algebra": { x: 1650, y: 2600, constellation: "Intermediate Programming", state: "locked" },
                    "Introduction to Hardware": { x: 779, y: 2362, constellation: "Intermediate Development", state: "locked" },
                    "Intro Computer Science": { x: 1115, y: 2169, constellation: "Intermediate Development", state: "locked" },
                    "Basic Concepts": { x: 1445, y: 2340, constellation: "Intermediate Development", state: "locked" },
                    "Console UI Fundamentals": { x: 1591, y: 2378, constellation: "Intermediate Development", state: "locked" },
                    "Advanced Debugging Techniques": { x: 740, y: 1936, constellation: "Advanced Development", state: "locked" },
                    "Assembly Language Programming": { x: 900, y: 2000, constellation: "Advanced Development", state: "locked" },
                    "SQL": { x: 1412, y: 1856, constellation: "Advanced Development", state: "locked" },
                    "Web to Desktop Design": { x: 1219, y: 1965, constellation: "Advanced Development", state: "locked" },
                    "HTML CSS": { x: 1976, y: 1838, constellation: "Advanced Development", state: "locked" },
                    "JavaScript/jQuery": { x: 2273, y: 2024, constellation: "Advanced Development", state: "locked" },
                    "Event Driven Programming": { x: 1626, y: 2068, constellation: "Advanced Development", state: "locked" },
                    "HTML CSS Concepts": { x: 2485, y: 1656, constellation: "Web Development", state: "locked" },
                    "Basic HTML Design": { x: 2689, y: 1408, constellation: "Web Development", state: "locked" },
                    "HTML to Web Fundamentals": { x: 2487, y: 1184, constellation: "Web Development", state: "locked" },
                    "Building Responsive Websites": { x: 2140, y: 1200, constellation: "Web Development", state: "locked" },
                    "Building Interactive Websites": { x: 2244, y: 1411, constellation: "Web Development", state: "locked" },
                    "Systems and Application Programming": { x: 580, y: 1415, constellation: "Systems Programming", state: "locked" },
                    "Operating System Fundamentals": { x: 468, y: 1344, constellation: "Systems Programming", state: "locked" },
                    "Cybersecurity Pathways": { x: 430, y: 1202, constellation: "Systems Programming", state: "locked" },
                    "Advanced Systems Programming": { x: 642, y: 1195, constellation: "Systems Programming", state: "locked" },
                    "Systems and Application Automation": { x: 316, y: 1040, constellation: "Systems Programming", state: "locked" },
                    "Industrial Automation": { x: 479, y: 945, constellation: "Systems Programming", state: "locked" },
                    "Software Engineering": { x: 875, y: 1531, constellation: "Software Engineering", state: "locked" },
                    "Advanced Software Development": { x: 1036, y: 1419, constellation: "Software Engineering", state: "locked" },
                    "Building Scalable Applications": { x: 760, y: 1245, constellation: "Software Engineering", state: "locked" },
                    "Software Architecture": { x: 1050, y: 1168, constellation: "Software Engineering", state: "locked" },
                    "Application Security": { x: 890, y: 946, constellation: "Software Engineering", state: "locked" },
                    "Modern Software Practices": { x: 872, y: 1116, constellation: "Software Engineering", state: "locked" },
                    "Front-End Development": { x: 1245, y: 1559, constellation: "Full Stack Development", state: "locked" },
                    "Back-End Development": { x: 1418, y: 1372, constellation: "Full Stack Development", state: "locked" },
                    "Full-Stack Development": { x: 1179, y: 1192, constellation: "Full Stack Development", state: "locked" },
                    "Web Development Pathways": { x: 1188, y: 958, constellation: "Full Stack Development", state: "locked" },
                    "Cloud Computing and DevOps": { x: 1292, y: 872, constellation: "Full Stack Development", state: "locked" },
                    "Advanced Cloud Development": { x: 1404, y: 913, constellation: "Full Stack Development", state: "locked" },
                    "Intro to Game Programming": { x: 1811, y: 1663, constellation: "Game Development", state: "locked" },
                    "Service Oriented Architecture": { x: 2049, y: 1619, constellation: "Game Development", state: "locked" },
                    "Advanced Game Programming": { x: 1802, y: 1358, constellation: "Game Development", state: "locked" },
                    "Game Engine Development": { x: 2105, y: 1084, constellation: "Game Development", state: "locked" },
                    "Mobile App Development": { x: 1893, y: 937, constellation: "Game Development", state: "locked" },
                    "Game Design Principles": { x: 1632, y: 778, constellation: "Game Development", state: "locked" },
                    "Data Science and Machine Learning": { x: 1597, y: 1739, constellation: "Data Science", state: "locked" },
                    "Statistical Analysis": { x: 1505, y: 1572, constellation: "Data Science", state: "locked" },
                    "Machine Learning Algorithms": { x: 1712, y: 1697, constellation: "Data Science", state: "locked" },
                    "Deep Learning": { x: 1589, y: 1264, constellation: "Data Science", state: "locked" },
                    "AI Development": { x: 1722, y: 1112, constellation: "Data Science", state: "locked" },
                    "Advanced Machine Learning": { x: 1812, y: 639, constellation: "Data Science", state: "locked" }
                };

                this.CONNECTIONS = [
                    // From Core Foundations to Basic Programming
                    ["Introduction to Operating Systems", "Basic Software Tools"],
                    ["Basic Computer Operations", "Programming/Basic Theory"],
                    ["Basic Arithmetic", "Programming/Basic Theory"],
                    ["Basic Arithmetic", "Text Manipulation"],
                    
                    // From Basic Programming to Intermediate Programming
                    ["Basic Software Tools", "Basic Database Concepts"],
                    ["Programming/Basic Theory", "Markup Languages"],
                    ["Programming/Basic Theory", "Object Oriented Programming"],
                    ["Text Manipulation", "Computer Science Algebra"],
                    
                    // From Intermediate Programming to Intermediate Development
                    ["Basic Database Concepts", "Introduction to Hardware"],
                    ["Markup Languages", "Intro Computer Science"],
                    ["Object Oriented Programming", "Basic Concepts"],
                    ["Computer Science Algebra", "Console UI Fundamentals"],
                    
                    // From Intermediate Development to Advanced Development
                    ["Introduction to Hardware", "Advanced Debugging Techniques"],
                    ["Intro Computer Science", "Assembly Language Programming"],
                    ["Basic Concepts", "SQL"],
                    ["Basic Concepts", "Web to Desktop Design"],
                    ["Console UI Fundamentals", "HTML CSS"],
                    ["Console UI Fundamentals", "JavaScript/jQuery"],
                    ["Console UI Fundamentals", "Event Driven Programming"],
                    
                    // Web Development specialization track
                    ["HTML CSS", "HTML CSS Concepts"],
                    ["JavaScript/jQuery", "HTML CSS Concepts"],
                    ["HTML CSS Concepts", "Basic HTML Design"],
                    ["Basic HTML Design", "HTML to Web Fundamentals"],
                    ["HTML to Web Fundamentals", "Building Responsive Websites"],
                    ["Building Responsive Websites", "Building Interactive Websites"],
                    
                    // Systems Programming specialization track
                    ["Advanced Debugging Techniques", "Systems and Application Programming"],
                    ["Systems and Application Programming", "Operating System Fundamentals"],
                    ["Operating System Fundamentals", "Cybersecurity Pathways"],
                    ["Cybersecurity Pathways", "Advanced Systems Programming"],
                    ["Advanced Systems Programming", "Systems and Application Automation"],
                    ["Systems and Application Automation", "Industrial Automation"],
                    
                    // Software Engineering specialization track
                    ["Assembly Language Programming", "Software Engineering"],
                    ["Software Engineering", "Advanced Software Development"],
                    ["Advanced Software Development", "Building Scalable Applications"],
                    ["Building Scalable Applications", "Software Architecture"],
                    ["Software Architecture", "Application Security"],
                    ["Application Security", "Modern Software Practices"],
                    
                    // Full Stack Development specialization track
                    ["Web to Desktop Design", "Front-End Development"],
                    ["SQL", "Back-End Development"],
                    ["Front-End Development", "Full-Stack Development"],
                    ["Back-End Development", "Full-Stack Development"],
                    ["Full-Stack Development", "Web Development Pathways"],
                    ["Web Development Pathways", "Cloud Computing and DevOps"],
                    ["Cloud Computing and DevOps", "Advanced Cloud Development"],
                    
                    // Game Development specialization track
                    ["Event Driven Programming", "Intro to Game Programming"],
                    ["Intro to Game Programming", "Service Oriented Architecture"],
                    ["Service Oriented Architecture", "Advanced Game Programming"],
                    ["Advanced Game Programming", "Game Engine Development"],
                    ["Game Engine Development", "Mobile App Development"],
                    ["Mobile App Development", "Game Design Principles"],
                    
                    // Data Science specialization track
                    ["SQL", "Data Science and Machine Learning"],
                    ["Data Science and Machine Learning", "Statistical Analysis"],
                    ["Statistical Analysis", "Machine Learning Algorithms"],
                    ["Machine Learning Algorithms", "Deep Learning"],
                    ["Deep Learning", "AI Development"],
                    ["AI Development", "Advanced Machine Learning"]
                ];

                this.CONSTELLATION_COLORS = {
                    "Core Foundations": "#00ff00",
                    "Basic Programming": "#87ceeb",
                    "Intermediate Programming": "#dda0dd",
                    "Intermediate Development": "#98fb98",
                    "Advanced Development": "#ffa07a",
                    "Web Development": "#ff6347",
                    "Systems Programming": "#20b2aa",
                    "Software Engineering": "#daa520",
                    "Full Stack Development": "#f0e68c",
                    "Game Development": "#9370db",
                    "Data Science": "#32cd32"
                };

                this.CONSTELLATION_POSITIONS = {
                    "Core Foundations": { x: 1391, y: 3256 },
                    "Basic Programming": { x: 1229, y: 2880 },
                    "Intermediate Programming": { x: 1237, y: 2582 },
                    "Intermediate Development": { x: 1156, y: 2290 },
                    "Advanced Development": { x: 1593, y: 1918 },
                    "Web Development": { x: 2372, y: 1397 },
                    "Systems Programming": { x: 483, y: 1286 },
                    "Software Engineering": { x: 858, y: 1301 },
                    "Full Stack Development": { x: 1200, y: 1300 },
                    "Game Development": { x: 1898, y: 1147 },
                    "Data Science": { x: 1552, y: 1382 }
                };
            }

            loadRoboticsData() {
                // Comprehensive Robotics skill tree - 96 skills across 5 interdisciplinary constellations
                this.SKILL_TREE = {
                    "Mechanics Basics": { x: 612, y: 4071, type: "root", constellation: "Mechanical Maker", state: "available" },
                    "Circuits Basics": { x: 994, y: 3932, type: "root", constellation: "Electric Explorer", state: "available" },
                    "Coding Basics": { x: 1353, y: 4066, type: "root", constellation: "Code Commander", state: "available" },
                    "Design Basics": { x: 1188, y: 4404, type: "root", constellation: "Tech Designer", state: "available" },
                    "Innovation Basics": { x: 719, y: 4384, type: "root", constellation: "Innovator & Problem Solver", state: "available" },
                    "Frame Build": { x: 184, y: 4123, constellation: "Mechanical Maker", state: "locked" },
                    "Axles & Wheels": { x: 447, y: 4053, constellation: "Mechanical Maker", state: "locked" },
                    "Motion Device": { x: 616, y: 3925, constellation: "Mechanical Maker", state: "locked" },
                    "Build Stability": { x: -33, y: 3820, constellation: "Mechanical Maker", state: "locked" },
                    "Gears & Torque": { x: 290, y: 3726, constellation: "Mechanical Maker", state: "locked" },
                    "Axle Compare": { x: 335, y: 3939, constellation: "Mechanical Maker", state: "locked" },
                    "Cranks & Pulleys": { x: 529, y: 3594, constellation: "Mechanical Maker", state: "locked" },
                    "2-Joint Arm": { x: 243, y: 3627, constellation: "Mechanical Maker", state: "locked" },
                    "Gear Integration": { x: 50, y: 3569, constellation: "Mechanical Maker", state: "locked" },
                    "Walker/Biped": { x: 37, y: 3386, constellation: "Mechanical Maker", state: "locked" },
                    "Balance & Springs": { x: -537, y: 3487, constellation: "Mechanical Maker", state: "locked" },
                    "Materials Choice": { x: 345, y: 3065, constellation: "Mechanical Maker", state: "locked" },
                    "Real-World Chassis": { x: 259, y: 2813, constellation: "Mechanical Maker", state: "locked" },
                    "Mech-Control Integr.": { x: 2220, y: 2646, constellation: "Mechanical Maker", state: "locked" },
                    "Test Iteration": { x: -204, y: 2835, constellation: "Mechanical Maker", state: "locked" },
                    "Labeled Mechanism": { x: -469, y: 3097, constellation: "Mechanical Maker", state: "locked" },
                    "Components ID": { x: 689, y: 3801, constellation: "Electric Explorer", state: "locked" },
                    "Electricity Flow": { x: 972, y: 3824, constellation: "Electric Explorer", state: "locked" },
                    "LED Switch": { x: 1141, y: 3812, constellation: "Electric Explorer", state: "locked" },
                    "Breadboard Use": { x: 800, y: 3684, constellation: "Electric Explorer", state: "locked" },
                    "Sensor Read": { x: 1229, y: 3619, constellation: "Electric Explorer", state: "locked" },
                    "Multimeter Use": { x: 963, y: 3614, constellation: "Electric Explorer", state: "locked" },
                    "Servo Drive": { x: 741, y: 3067, constellation: "Electric Explorer", state: "locked" },
                    "Sensor Logic": { x: 1121, y: 3313, constellation: "Electric Explorer", state: "locked" },
                    "Light/Sound React": { x: 1092, y: 3516, constellation: "Electric Explorer", state: "locked" },
                    "Sensor Toggle": { x: 1457, y: 3558, constellation: "Code Commander", state: "locked" },
                    "Motor+Sensor Circuit": { x: 1176, y: 3203, constellation: "Electric Explorer", state: "locked" },
                    "Power Budget": { x: 932, y: 3492, constellation: "Electric Explorer", state: "locked" },
                    "Sensor Control": { x: 1309, y: 3124, constellation: "Electric Explorer", state: "locked" },
                    "Regulators & Polarity": { x: 928, y: 3251, constellation: "Electric Explorer", state: "locked" },
                    "Alarm Device": { x: 1062, y: 3383, constellation: "Electric Explorer", state: "locked" },
                    "Transistors/Relays": { x: 563, y: 3366, constellation: "Electric Explorer", state: "locked" },
                    "Multi-Load Power": { x: 642, y: 2962, constellation: "Electric Explorer", state: "locked" },
                    "Soldering": { x: 868, y: 2851, constellation: "Electric Explorer", state: "locked" },
                    "Autonomous Power": { x: 982, y: 3018, constellation: "Electric Explorer", state: "locked" },
                    "Enclosure Build": { x: 1117, y: 2922, constellation: "Electric Explorer", state: "locked" },
                    "Circuit Diagram": { x: 1410, y: 2805, constellation: "Electric Explorer", state: "locked" },
                    "Starter Code": { x: 1597, y: 4061, constellation: "Code Commander", state: "locked" },
                    "Inputs ID": { x: 1522, y: 3897, constellation: "Code Commander", state: "locked" },
                    "Parameter Tuning": { x: 1318, y: 3897, constellation: "Code Commander", state: "locked" },
                    "If/Else & Loops": { x: 1539, y: 3378, constellation: "Code Commander", state: "locked" },
                    "Debug Syntax": { x: 1867, y: 3758, constellation: "Code Commander", state: "locked" },
                    "Blink LED": { x: 1947, y: 4040, constellation: "Code Commander", state: "locked" },
                    "Input â†’ Output": { x: 1404, y: 3748, constellation: "Code Commander", state: "locked" },
                    "Functions": { x: 1754, y: 3639, constellation: "Code Commander", state: "locked" },
                    "Serial Monitor": { x: 2058, y: 3753, constellation: "Code Commander", state: "locked" },
                    "Libraries": { x: 2041, y: 3527, constellation: "Code Commander", state: "locked" },
                    "Menu/UI": { x: 1789, y: 3439, constellation: "Code Commander", state: "locked" },
                    "Timers/Millis": { x: 2250, y: 3838, constellation: "Code Commander", state: "locked" },
                    "Interrupts/States": { x: 1918, y: 3329, constellation: "Code Commander", state: "locked" },
                    "Concurrent Code": { x: 2163, y: 3311, constellation: "Code Commander", state: "locked" },
                    "Optimize Code": { x: 1987, y: 3147, constellation: "Code Commander", state: "locked" },
                    "RF/Bluetooth": { x: 2441, y: 3596, constellation: "Code Commander", state: "locked" },
                    "Auto Behavior": { x: 2172, y: 3001, constellation: "Code Commander", state: "locked" },
                    "Code Docs": { x: 2347, y: 3236, constellation: "Code Commander", state: "locked" },
                    "Labeled Sketch": { x: 1562, y: 4962, constellation: "Tech Designer", state: "locked" },
                    "Part Explain": { x: 1696, y: 4492, constellation: "Tech Designer", state: "locked" },
                    "Design Weakness": { x: 1605, y: 4681, constellation: "Tech Designer", state: "locked" },
                    "Plan Template": { x: 1910, y: 4928, constellation: "Tech Designer", state: "locked" },
                    "Record Measures": { x: 1923, y: 5283, constellation: "Tech Designer", state: "locked" },
                    "Present Concept": { x: 1909, y: 4690, constellation: "Tech Designer", state: "locked" },
                    "BOM": { x: 1582, y: 5269, constellation: "Tech Designer", state: "locked" },
                    "Tinkercad Model": { x: 2224, y: 5075, constellation: "Tech Designer", state: "locked" },
                    "Label Schematics": { x: 2509, y: 5117, constellation: "Tech Designer", state: "locked" },
                    "Goals Fit": { x: 2382, y: 4534, constellation: "Tech Designer", state: "locked" },
                    "Scaled Drawings": { x: 2252, y: 5273, constellation: "Tech Designer", state: "locked" },
                    "Simulate System": { x: 3076, y: 4586, constellation: "Tech Designer", state: "locked" },
                    "Design Log": { x: 3230, y: 4924, constellation: "Tech Designer", state: "locked" },
                    "Material Eval": { x: 2966, y: 5207, constellation: "Tech Designer", state: "locked" },
                    "Fusion 360": { x: 2500, y: 5467, constellation: "Tech Designer", state: "locked" },
                    "CAD Assemblies": { x: 2662, y: 5564, constellation: "Tech Designer", state: "locked" },
                    "Tech Prints": { x: 2550, y: 5257, constellation: "Tech Designer", state: "locked" },
                    "Client Design": { x: 2799, y: 5510, constellation: "Tech Designer", state: "locked" },
                    "Pro Presentation": { x: 3122, y: 5517, constellation: "Tech Designer", state: "locked" },
                    "Design Portfolio": { x: 3239, y: 5775, constellation: "Tech Designer", state: "locked" },
                    "Budget Limits": { x: 1642, y: 5453, constellation: "Tech Designer", state: "locked" },
                    "Idea Brainstorm": { x: 404, y: 4466, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Problem Describe": { x: 477, y: 4715, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Success Criteria": { x: 1029, y: 4839, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Invention Sketch": { x: 249, y: 4639, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Test Plan": { x: 1030, y: 5136, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Low-Fi Proto": { x: -183, y: 4575, constellation: "Innovator & Problem Solver", state: "locked" },
                    "User Interview": { x: 4, y: 4918, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Usability Test": { x: 1374, y: 5430, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Multi Prototypes": { x: -759, y: 5031, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Feedback Iterate": { x: 190, y: 5351, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Constraint Track": { x: 791, y: 5733, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Version Compare": { x: -186, y: 5567, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Team Lead": { x: 957, y: 5943, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Research Docs": { x: 773, y: 6148, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Final Prototype": { x: 198, y: 5814, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Reliability Test": { x: -264, y: 5794, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Impact Project": { x: 256, y: 6207, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Public Present": { x: 762, y: 6322, constellation: "Innovator & Problem Solver", state: "locked" },
                    "Scale Plan": { x: -503, y: 6266, constellation: "Innovator & Problem Solver", state: "locked" }
                };

                this.CONNECTIONS = [
                    // From root nodes (direct connections only)
                    ["Mechanics Basics", "Frame Build"],
                    ["Mechanics Basics", "Axles & Wheels"],
                    ["Mechanics Basics", "Motion Device"],
                    ["Circuits Basics", "Components ID"],
                    ["Circuits Basics", "Electricity Flow"],
                    ["Circuits Basics", "LED Switch"],
                    ["Coding Basics", "Starter Code"],
                    ["Coding Basics", "Inputs ID"],
                    ["Coding Basics", "Parameter Tuning"],
                    ["Design Basics", "Labeled Sketch"],
                    ["Design Basics", "Part Explain"],
                    ["Design Basics", "Design Weakness"],
                    ["Innovation Basics", "Idea Brainstorm"],
                    ["Innovation Basics", "Problem Describe"],
                    ["Innovation Basics", "Success Criteria"],
                    
                    // Mechanical Maker - simplified paths
                    ["Frame Build", "Build Stability"],
                    ["Frame Build", "Gears & Torque"],
                    ["Axles & Wheels", "Axle Compare"],
                    ["Motion Device", "Gears & Torque"],
                    ["Motion Device", "Cranks & Pulleys"],
                    ["Axle Compare", "Gears & Torque"],
                    ["Gears & Torque", "Cranks & Pulleys"],
                    ["Cranks & Pulleys", "2-Joint Arm"],
                    ["Build Stability", "2-Joint Arm"],
                    ["2-Joint Arm", "Gear Integration"],
                    ["Gear Integration", "Walker/Biped"],
                    ["Walker/Biped", "Balance & Springs"],
                    ["Walker/Biped", "Materials Choice"],
                    ["Balance & Springs", "Real-World Chassis"],
                    ["Materials Choice", "Real-World Chassis"],
                    ["Real-World Chassis", "Mech-Control Integr."],
                    ["Real-World Chassis", "Test Iteration"],
                    ["Real-World Chassis", "Labeled Mechanism"],
                    ["Test Iteration", "Labeled Mechanism"],
                    
                    // Electric Explorer - simplified paths
                    ["Components ID", "Breadboard Use"],
                    ["Electricity Flow", "Breadboard Use"],
                    ["LED Switch", "Breadboard Use"],
                    ["Breadboard Use", "Sensor Read"],
                    ["Breadboard Use", "Multimeter Use"],
                    ["Breadboard Use", "Servo Drive"],
                    ["Sensor Read", "Sensor Logic"],
                    ["Sensor Read", "Light/Sound React"],
                    ["Sensor Read", "Sensor Toggle"],
                    ["Multimeter Use", "Power Budget"],
                    ["Servo Drive", "Motor+Sensor Circuit"],
                    ["Servo Drive", "Power Budget"],
                    ["Servo Drive", "Sensor Control"],
                    ["Sensor Logic", "Motor+Sensor Circuit"],
                    ["Light/Sound React", "Alarm Device"],
                    ["Motor+Sensor Circuit", "Regulators & Polarity"],
                    ["Motor+Sensor Circuit", "Sensor Control"],
                    ["Regulators & Polarity", "Alarm Device"],
                    ["Regulators & Polarity", "Power Budget"],
                    ["Power Budget", "Transistors/Relays"],
                    ["Transistors/Relays", "Multi-Load Power"],
                    ["Multi-Load Power", "Soldering"],
                    ["Multi-Load Power", "Autonomous Power"],
                    ["Soldering", "Enclosure Build"],
                    ["Soldering", "Circuit Diagram"],
                    ["Autonomous Power", "Enclosure Build"],
                    ["Circuit Diagram", "Mech-Control Integr."],
                    
                    // Code Commander - simplified paths
                    ["Starter Code", "If/Else & Loops"],
                    ["Starter Code", "Debug Syntax"],
                    ["Starter Code", "Blink LED"],
                    ["Inputs ID", "Input â†’ Output"],
                    ["Parameter Tuning", "Input â†’ Output"],
                    ["If/Else & Loops", "Functions"],
                    ["If/Else & Loops", "Sensor Toggle"],
                    ["Debug Syntax", "Serial Monitor"],
                    ["Blink LED", "Timers/Millis"],
                    ["Input â†’ Output", "Sensor Toggle"],
                    ["Functions", "Libraries"],
                    ["Functions", "Menu/UI"],
                    ["Serial Monitor", "Libraries"],
                    ["Libraries", "Menu/UI"],
                    ["Libraries", "Timers/Millis"],
                    ["Menu/UI", "Interrupts/States"],
                    ["Timers/Millis", "Interrupts/States"],
                    ["Timers/Millis", "Concurrent Code"],
                    ["Interrupts/States", "Concurrent Code"],
                    ["Interrupts/States", "Optimize Code"],
                    ["Concurrent Code", "Auto Behavior"],
                    ["Concurrent Code", "RF/Bluetooth"],
                    ["Optimize Code", "Auto Behavior"],
                    ["RF/Bluetooth", "Code Docs"],
                    ["Auto Behavior", "Code Docs"],
                    ["Sensor Toggle", "Sensor Control"],
                    ["Sensor Control", "Auto Behavior"],
                    
                    // Cross-constellation critical connections
                    ["Mech-Control Integr.", "Auto Behavior"],
                    ["Autonomous Power", "Auto Behavior"],
                    
                    // Tech Designer - simplified paths
                    ["Labeled Sketch", "Plan Template"],
                    ["Labeled Sketch", "Record Measures"],
                    ["Labeled Sketch", "Present Concept"],
                    ["Labeled Sketch", "BOM"],
                    ["Part Explain", "Present Concept"],
                    ["Design Weakness", "Plan Template"],
                    ["Plan Template", "Tinkercad Model"],
                    ["Record Measures", "Scaled Drawings"],
                    ["Present Concept", "Goals Fit"],
                    ["BOM", "Budget Limits"],
                    ["Tinkercad Model", "Label Schematics"],
                    ["Tinkercad Model", "Simulate System"],
                    ["Label Schematics", "Tech Prints"],
                    ["Goals Fit", "Simulate System"],
                    ["Scaled Drawings", "Fusion 360"],
                    ["Simulate System", "Design Log"],
                    ["Simulate System", "Material Eval"],
                    ["Simulate System", "Mech-Control Integr."],
                    ["Design Log", "Design Portfolio"],
                    ["Material Eval", "Fusion 360"],
                    ["Fusion 360", "CAD Assemblies"],
                    ["Fusion 360", "Tech Prints"],
                    ["CAD Assemblies", "Client Design"],
                    ["Tech Prints", "Client Design"],
                    ["Client Design", "Pro Presentation"],
                    ["Pro Presentation", "Design Portfolio"],
                    ["Pro Presentation", "Public Present"],
                    
                    // Innovator & Problem Solver - simplified paths
                    ["Idea Brainstorm", "Invention Sketch"],
                    ["Problem Describe", "Invention Sketch"],
                    ["Success Criteria", "Test Plan"],
                    ["Invention Sketch", "Low-Fi Proto"],
                    ["Low-Fi Proto", "User Interview"],
                    ["Low-Fi Proto", "Test Plan"],
                    ["User Interview", "Multi Prototypes"],
                    ["User Interview", "Feedback Iterate"],
                    ["Test Plan", "Usability Test"],
                    ["Multi Prototypes", "Version Compare"],
                    ["Usability Test", "Feedback Iterate"],
                    ["Usability Test", "Constraint Track"],
                    ["Budget Limits", "Constraint Track"],
                    ["Feedback Iterate", "Final Prototype"],
                    ["Version Compare", "Final Prototype"],
                    ["Constraint Track", "Team Lead"],
                    ["Constraint Track", "Final Prototype"],
                    ["Team Lead", "Research Docs"],
                    ["Research Docs", "Final Prototype"],
                    ["Final Prototype", "Reliability Test"],
                    ["Final Prototype", "Impact Project"],
                    ["Final Prototype", "Public Present"],
                    ["Reliability Test", "Scale Plan"],
                    ["Impact Project", "Public Present"],
                    ["Public Present", "Scale Plan"]
                ];

                this.CONSTELLATION_COLORS = {
                    "Mechanical Maker": "#ff4500",
                    "Electric Explorer": "#00bfff",
                    "Code Commander": "#32cd32",
                    "Tech Designer": "#9370db",
                    "Innovator & Problem Solver": "#ffd700"
                };

                this.CONSTELLATION_POSITIONS = {
                    "Mechanical Maker": { x: 988, y: 4063 },
                    "Electric Explorer": { x: 596, y: 4190 },
                    "Code Commander": { x: 1253, y: 4177 },
                    "Tech Designer": { x: 1160, y: 4558 },
                    "Innovator & Problem Solver": { x: 460, y: 4590 }
                };
            }

            // === PROGRESS MANAGEMENT ===
            initializeProgress() {
                this.skillProgress = {};
                Object.keys(this.SKILL_TREE).forEach(skill => {
                    this.skillProgress[skill] = this.SKILL_TREE[skill].type === 'root' ? 'available' : 'locked';
                });
            }

            applyProgress(progressObj) {
              if (!progressObj || typeof progressObj !== 'object') return false;
            
              Object.keys(this.SKILL_TREE).forEach(name => {
                if (Object.prototype.hasOwnProperty.call(progressObj, name)) {
                  const state = progressObj[name];
                  const fallback = this.SKILL_TREE[name].type === 'root' ? 'available' : 'locked';
                  this.SKILL_TREE[name].state =
                    (state === 'locked' || state === 'available' || state === 'activated') ? state : fallback;
                }
              });
            
              this.skillProgress = {};
              Object.keys(this.SKILL_TREE).forEach(name => {
                this.skillProgress[name] = this.SKILL_TREE[name].state;
              });
            
              return true;
            }

            updateProgress(newProgress) {
                this.applyProgress(newProgress);
                this.updateAvailableSkills();
                this.refreshAllVisuals();
            }

            // === SKILL LOGIC ===
            getPrerequisites(skillName) {
                return this.CONNECTIONS.filter(([from, to]) => to === skillName).map(([from]) => from);
            }

            getImmediatePrerequisites(skillName) {
                const directPrereqs = this.getPrerequisites(skillName);
                
                const filtered = directPrereqs.filter(prereq => {
                    return !directPrereqs.some(otherPrereq => {
                        if (otherPrereq === prereq) return false;
                        return this.isPrerequisiteOf(prereq, otherPrereq);
                    });
                });
                
                return [...new Set(filtered)];
            }

            isPrerequisiteOf(skillA, skillB, visited = new Set()) {
                if (visited.has(skillB)) return false;
                visited.add(skillB);
                
                const directPrereqs = this.getPrerequisites(skillB);
                
                if (directPrereqs.includes(skillA)) return true;
                
                return directPrereqs.some(prereq => this.isPrerequisiteOf(skillA, prereq, visited));
            }

            getPrerequisiteChain(skillName, visited = new Set()) {
                if (visited.has(skillName)) return [];
                visited.add(skillName);
                
                const directPrereqs = this.getPrerequisites(skillName);
                let chain = [];
                
                directPrereqs.forEach(prereq => {
                    chain = chain.concat(this.getPrerequisiteChain(prereq, visited));
                    if (!chain.includes(prereq)) chain.push(prereq);
                });
                
                return chain;
            }

            canUnlock(skillName) {
                return this.getPrerequisites(skillName).every(prereq => this.SKILL_TREE[prereq].state === 'activated');
            }

            activateSkill(skillName) {
                const skill = this.SKILL_TREE[skillName];
                if (skill.state !== 'available') return;
                
                // Send unlock request to parent
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'SKILL_UNLOCKED',
                        subject: this.currentSubject,
                        skillName: skillName,
                        state: 'activated'
                    }, '*');
                }
                
                // Optimistically update UI
                skill.state = 'activated';
                this.skillProgress[skillName] = 'activated';
                this.updateNodeVisuals(skillName);
                this.updateAvailableSkills();
                this.updateConnections();
            }

            updateAvailableSkills() {
                Object.keys(this.SKILL_TREE).forEach(skillName => {
                    const skill = this.SKILL_TREE[skillName];
                    if (skill.state === 'locked' && this.canUnlock(skillName)) {
                        skill.state = 'available';
                        this.skillProgress[skillName] = 'available';
                        this.updateNodeVisuals(skillName);
                    }
                });
            }

            // === UI SETUP ===
            setupUI() {
                const elements = ['controls', 'legend', 'viewport', 'zoomControls'];
                elements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('hidden');
                });
                
                this.viewport = document.getElementById('viewport');
                this.container = document.getElementById('constellation');
                
                // Adjust container size based on subject
                if (this.container) {
                    if (this.currentSubject === 'Robotics') {
                        this.container.style.width = '4000px';
                        this.container.style.height = '4000px';
                    } else if (this.currentSubject === 'Programming') {
                        this.container.style.width = '3000px';
                        this.container.style.height = '3500px';
                    } else if (this.currentSubject === 'Math'){
                        this.container.style.width = '2400px';
                        this.container.style.height = '3000px';
                    } else {
                        this.container.style.width = '2400px';
                        this.container.style.height = '2000px';
                    }
                }
                
                this.currentX = 0;
                this.currentY = 0;
                this.currentScale = 1;
                
                this.setupTouchControls();
                this.setupZoomControls();
            }

            enterApplication() {
                // Hide loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }

                this.showElement('controls');
                this.showElement('legend');
                this.showElement('viewport');
                this.showElement('zoomControls');
                
                this.initializeSkillTree();
                
                setTimeout(() => {
                    this.centerViewport();
                }, 50);
            }

            // === TOUCH AND ZOOM CONTROLS ===
            setupTouchControls() {
                if (!this.viewport || !this.container) return;
                
                this.viewport.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: false });
                this.viewport.addEventListener('touchmove', (e) => this.handleTouchMove(e), { passive: false });
                this.viewport.addEventListener('touchend', (e) => this.handleTouchEnd(e), { passive: false });
                
                this.viewport.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                this.viewport.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                this.viewport.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                this.viewport.addEventListener('mouseleave', (e) => this.handleMouseUp(e));
                
                this.viewport.addEventListener('contextmenu', e => e.preventDefault());
            }

            setupZoomControls() {
                const btnIn = document.getElementById('zoomIn');
                const btnOut = document.getElementById('zoomOut');
                const btnCenter = document.getElementById('centerView');

                btnIn && btnIn.addEventListener('click', () => this.zoom(+1));
                btnOut && btnOut.addEventListener('click', () => this.zoom(-1));
                btnCenter && btnCenter.addEventListener('click', () => this.centerViewport());
            }

            handleTouchStart(e) {
                e.preventDefault();
                if (e.touches.length === 1) {
                    this.startDrag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }
            
            handleTouchMove(e) {
                e.preventDefault();
                if (e.touches.length === 1 && this.isDragging) {
                    this.drag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }
            
            handleTouchEnd(e) {
                e.preventDefault();
                this.endDrag();
            }
            
            handleMouseDown(e) {
                this.startDrag(e.clientX, e.clientY);
            }
            
            handleMouseMove(e) {
                if (this.isDragging) {
                    this.drag(e.clientX, e.clientY);
                }
            }
            
            handleMouseUp(e) {
                this.endDrag();
            }
            
            startDrag(x, y) {
                this.isDragging = true;
                this.startX = x;
                this.startY = y;
                this.dragStartX = this.currentX;
                this.dragStartY = this.currentY;
                this.viewport.classList.add('dragging');
            }
            
            drag(x, y) {
                if (!this.isDragging) return;
                
                const deltaX = x - this.startX;
                const deltaY = y - this.startY;
                
                this.currentX = this.dragStartX + deltaX;
                this.currentY = this.dragStartY + deltaY;
                
                this.updateTransform();
            }
            
            endDrag() {
                this.isDragging = false;
                this.viewport.classList.remove('dragging');
            }

            zoom(direction) {
                if (!this.viewport || !this.container) return;

                const STEP = 1.15;
                const factor = direction > 0 ? STEP : 1 / STEP;

                const vpW = this.viewport.offsetWidth;
                const vpH = this.viewport.offsetHeight;
                const centerX = vpW / 2;
                const centerY = vpH / 2;

                const worldX = (centerX - this.currentX) / this.currentScale;
                const worldY = (centerY - this.currentY) / this.currentScale;

                const newScale = Math.max(0.2, Math.min(2, this.currentScale * factor));
                if (newScale === this.currentScale) return;

                this.currentScale = newScale;

                this.currentX = centerX - worldX * this.currentScale;
                this.currentY = centerY - worldY * this.currentScale;

                this.updateTransform();
            }

            centerViewport() {
                if (!this.viewport || !this.container) return;

                const vpW = this.viewport.offsetWidth;
                const vpH = this.viewport.offsetHeight;

                let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
                Object.values(this.SKILL_TREE).forEach(s => {
                    minX = Math.min(minX, s.x);
                    maxX = Math.max(maxX, s.x);
                    minY = Math.min(minY, s.y);
                    maxY = Math.max(maxY, s.y);
                });
                if (!isFinite(minX) || !isFinite(minY)) return;

                const cx = (minX + maxX) / 2;
                const cy = (minY + maxY) / 2;

                const vpCenterX = vpW / 2;
                const vpCenterY = vpH / 2;
                this.currentX = vpCenterX - (cx * this.currentScale);
                this.currentY = vpCenterY - (cy * this.currentScale);

                this.updateTransform();
            }

            updateTransform() {
                if (!this.container || !this.viewport) return;

                const vpW = this.viewport.offsetWidth;
                const vpH = this.viewport.offsetHeight;
                
                // Use different world sizes based on subject
                let worldW, worldH;
                if (this.currentSubject === 'Robotics') {
                    worldW = 4000;
                    worldH = 4000;
                } else if (this.currentSubject === 'Programming') {
                    worldW = 3000;
                    worldH = 3500;
                } else {
                    worldW = 2400;
                    worldH = 2000;
                }

                const scaledW = worldW * this.currentScale;
                const scaledH = worldH * this.currentScale;

                const overpanX = Math.max(scaledW, vpW) * 0.10;
                const overpanY = Math.max(scaledH, vpH) * 0.10;

                let minX, maxX, minY, maxY;

                if (scaledW >= vpW) {
                    minX = vpW - scaledW - overpanX;
                    maxX = overpanX;
                } else {
                    const centerX = (vpW - scaledW) / 2;
                    minX = centerX - overpanX;
                    maxX = centerX + overpanX;
                }

                if (scaledH >= vpH) {
                    minY = vpH - scaledH - overpanY;
                    maxY = overpanY;
                } else {
                    const centerY = (vpH - scaledH) / 2;
                    minY = centerY - overpanY;
                    maxY = centerY + overpanY;
                }

                this.currentX = Math.max(minX, Math.min(maxX, this.currentX));
                this.currentY = Math.max(minY, Math.min(maxY, this.currentY));

                this.container.style.transform = `translate(${this.currentX}px, ${this.currentY}px) scale(${this.currentScale})`;
            }

            // === SKILL NODE INTERACTION ===
            setupNodeTouchHandling(node, skillName) {
                let touchStartTime = 0;
                let longPressActive = false;
                let touchMoved = false;

                const handleTouchStart = (e) => {
                    e.stopPropagation();
                    touchStartTime = Date.now();
                    longPressActive = false;
                    touchMoved = false;

                    if (this.longPressTimer) clearTimeout(this.longPressTimer);
                    this.longPressTimer = setTimeout(() => {
                        if (!touchMoved && !this.isDragging) {
                            longPressActive = true;
                            this.showTooltipForNode(node, skillName);
                            node.classList.add('highlighted');
                            this.startPathHighlight(skillName);
                            if (navigator.vibrate) navigator.vibrate(50);
                        }
                    }, this.LONG_PRESS_DURATION);
                };

                const handleTouchMove = () => {
                    touchMoved = true;
                    if (this.longPressTimer) {
                        clearTimeout(this.longPressTimer);
                        this.longPressTimer = null;
                    }
                };

                const handleTouchEnd = (e) => {
                    e.stopPropagation();
                    const touchDuration = Date.now() - touchStartTime;
                    if (this.longPressTimer) {
                        clearTimeout(this.longPressTimer);
                        this.longPressTimer = null;
                    }

                    if (longPressActive) {
                        this.hideTooltip();
                        node.classList.remove('highlighted');
                        this.clearPathHighlight();
                        longPressActive = false;
                    } else if (!touchMoved && touchDuration < this.LONG_PRESS_DURATION && !this.isDragging) {
                        const skill = this.SKILL_TREE[skillName];
                        if (skill && skill.state === 'available') this.activateSkill(skillName);
                    }
                    touchMoved = false;
                };

                if (this.isMobile) {
                    node.addEventListener('touchstart', handleTouchStart, { passive: false });
                    node.addEventListener('touchmove', handleTouchMove, { passive: false });
                    node.addEventListener('touchend', handleTouchEnd, { passive: false });
                } else {
                    node.addEventListener('mouseenter', () => {
                        this.showTooltipForNode(node, skillName);
                        this.startPathHighlight(skillName);
                    });
                    node.addEventListener('mouseleave', () => {
                        this.hideTooltip();
                        node.classList.remove('highlighted');
                        this.clearPathHighlight();
                    });
                    node.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (this.isDragging) return;
                        const skill = this.SKILL_TREE[skillName];
                        if (skill && skill.state === 'available') this.activateSkill(skillName);
                    });
                }
            }

            // === PATH HIGHLIGHTING ===
            startPathHighlight(targetName) {
                if (!this.container || !this.connectionElements) return;

                const chain = new Set(this.getPrerequisiteChain(targetName));
                chain.add(targetName);

                this.container.classList.add('dim-lines');
                this.connectionElements.forEach(line => {
                    const to = line.dataset.to;
                    if (chain.has(to)) {
                        line.classList.add('highlighted');
                    } else {
                        line.classList.remove('highlighted');
                    }
                });
            }

            clearPathHighlight() {
                if (!this.container || !this.connectionElements) return;
                this.container.classList.remove('dim-lines');
                this.connectionElements.forEach(line => line.classList.remove('highlighted'));
            }

            // === TOOLTIP HANDLING ===
            showTooltipForNode(node, skillName) {
                const tooltip = document.getElementById('tooltip');
                if (!tooltip) return;
                
                const prereqs = this.getImmediatePrerequisites(skillName);
                const prereqText = prereqs.length > 0 
                    ? '<strong>Prerequisites:</strong><br>' + prereqs.map(p => `â€¢ ${p}`).join('<br>')
                    : '<strong>No prerequisites required</strong>';
                
                tooltip.innerHTML = `<strong>${skillName}</strong><br>${prereqText}`;
                
                const rect = node.getBoundingClientRect();
                const tooltipRect = tooltip.getBoundingClientRect();
                
                let left = rect.left + rect.width / 2 - tooltipRect.width / 2;
                let top = rect.top - tooltipRect.height - 10;
                
                if (left < 10) left = 10;
                if (left + tooltipRect.width > window.innerWidth - 10) {
                    left = window.innerWidth - tooltipRect.width - 10;
                }
                if (top < 10) {
                    top = rect.bottom + 10;
                }
                
                tooltip.style.cssText += `
                    display: block;
                    left: ${left}px;
                    top: ${top}px;
                `;
            }

            hideTooltip() {
                const tooltip = document.getElementById('tooltip');
                if (tooltip) tooltip.style.display = 'none';
            }

            // === RENDERING ===
            createConnectionLine(from, to) {
                const fromSkill = this.SKILL_TREE[from];
                const toSkill = this.SKILL_TREE[to];
                if (!fromSkill || !toSkill) return null;
                
                const line = document.createElement('div');
                const isCross = fromSkill.constellation !== toSkill.constellation;
                line.className = `connection-line ${isCross ? 'cross' : ''}`;
                line.dataset.from = from;
                line.dataset.to = to;
                
                const dx = toSkill.x - fromSkill.x;
                const dy = toSkill.y - fromSkill.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                // Use different node offset based on subject
                let nodeOffset;
                if (this.currentSubject === 'Programming' || this.currentSubject === 'Robotics') {
                    nodeOffset = 30;
                } else {
                    nodeOffset = 25;
                }
                
                line.style.cssText += `
                    left: ${fromSkill.x + nodeOffset}px;
                    top: ${fromSkill.y + nodeOffset}px;
                    width: ${length}px;
                    transform: rotate(${angle}deg);
                `;
                
                return line;
            }

            createSkillNode(name, skill) {
                const node = document.createElement('div');
                let className = `skill-node ${skill.type || ''} ${skill.state}`;
                
                // Add special class for root nodes in Programming and Robotics
                if (skill.type === 'root' && (this.currentSubject === 'Programming' || this.currentSubject === 'Robotics')) {
                    className += ' programming';
                }
                
                node.className = className;
                node.dataset.skillName = name;
                
                let displayText = name;
                let maxLength, truncateLength;
                
                // Different text handling based on subject
                if (this.currentSubject === 'Robotics') {
                    maxLength = 12;
                    truncateLength = 10;
                } else if (this.currentSubject === 'Programming') {
                    maxLength = 15;
                    truncateLength = 12;
                } else {
                    maxLength = 12;
                    truncateLength = 10;
                }
                
                if (this.isMobile && name.length > 10) {
                    displayText = name.substring(0, 8) + '...';
                } else if (name.length > maxLength) {
                    displayText = name.substring(0, truncateLength) + '...';
                }
                node.textContent = displayText;
                
                // Adjust node size and font based on subject
                let nodeSize, rootSize, fontSize;
                
                if (this.currentSubject === 'Robotics') {
                    nodeSize = '60px';
                    rootSize = '80px';
                    fontSize = '7px';
                } else if (this.currentSubject === 'Programming') {
                    nodeSize = '60px';
                    rootSize = '90px';
                    fontSize = '8px';
                } else {
                    nodeSize = '50px';
                    rootSize = '80px';
                    fontSize = '8px';
                }
                
                let nodeStyles = `
                    left: ${skill.x}px;
                    top: ${skill.y}px;
                    border-color: ${this.CONSTELLATION_COLORS[skill.constellation] || '#d4af37'};
                    width: ${nodeSize};
                    height: ${nodeSize};
                    font-size: ${fontSize};
                `;
                
                if (skill.type === 'root') {
                    nodeStyles += `
                        width: ${rootSize};
                        height: ${rootSize};
                        font-size: ${this.currentSubject === 'Robotics' ? '9px' : '10px'};
                    `;
                }
                
                node.style.cssText = nodeStyles;
                
                this.setupNodeTouchHandling(node, name);
                
                return node;
            }

            createConstellationLabel(name, pos) {
                const label = document.createElement('div');
                label.className = 'constellation-label';
                label.textContent = name;
                label.style.cssText = `
                    left: ${pos.x}px;
                    top: ${pos.y}px;
                    color: ${this.CONSTELLATION_COLORS[name]};
                `;
                return label;
            }

            createStars() {
                const starsContainer = document.getElementById('stars');
                if (!starsContainer) return;
                
                starsContainer.innerHTML = '';
                const starCount = this.isMobile ? 150 : 300;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.style.cssText = `
                        position: absolute;
                        width: 2px;
                        height: 2px;
                        background: white;
                        border-radius: 50%;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                        opacity: ${0.3 + Math.random() * 0.4};
                        animation: twinkle ${2 + Math.random() * 2}s infinite;
                    `;
                    starsContainer.appendChild(star);
                }
            }

            updateNodeVisuals(skillName) {
                const node = document.querySelector(`[data-skill-name="${skillName}"]`);
                if (node) {
                    const skill = this.SKILL_TREE[skillName];
                    let className = `skill-node ${skill.type || ''} ${skill.state}`;
                    
                    // Add programming class for root nodes in Programming and Robotics subjects
                    if (skill.type === 'root' && (this.currentSubject === 'Programming' || this.currentSubject === 'Robotics')) {
                        className += ' programming';
                    }
                    
                    node.className = className;
                }
            }

            updateConnections() {
                this.connectionElements.forEach(line => {
                    const fromSkill = line.dataset.from;
                    const toSkill = line.dataset.to;
                    const fromActivated = this.SKILL_TREE[fromSkill].state === 'activated';
                    const toActivated = this.SKILL_TREE[toSkill].state === 'activated';
                    
                    if (fromActivated && toActivated) {
                        line.classList.add('active');
                    } else {
                        line.classList.remove('active');
                    }
                });
            }

            refreshAllVisuals() {
                Object.keys(this.SKILL_TREE).forEach(skillName => {
                    this.updateNodeVisuals(skillName);
                });
                this.updateConnections();
            }

            initializeSkillTree() {
                if (!this.container) return;
                
                this.container.innerHTML = '<div id="stars"></div>';
                this.connectionElements = [];
                
                // Create connections
                this.CONNECTIONS.forEach(([from, to]) => {
                    const line = this.createConnectionLine(from, to);
                    if (line) {
                        this.container.appendChild(line);
                        this.connectionElements.push(line);
                    }
                });
                
                // Create constellation labels
                Object.entries(this.CONSTELLATION_POSITIONS).forEach(([name, pos]) => {
                    this.container.appendChild(this.createConstellationLabel(name, pos));
                });
                
                // Create skill nodes
                Object.entries(this.SKILL_TREE).forEach(([name, skill]) => {
                    this.container.appendChild(this.createSkillNode(name, skill));
                });
                
                this.createStars();
                this.updateAvailableSkills();
                this.updateConnections();
            }

            // === UTILITY FUNCTIONS ===
            showElement(id) {
                const el = document.getElementById(id);
                if (el) el.classList.remove('hidden');
            }

            hideElement(id) {
                const el = document.getElementById(id);
                if (el) el.classList.add('hidden');
            }
        }

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            window.skillTreeManager = new MultiSubjectSkillTreeManager();
        });
    </script>
</body>
</html>


