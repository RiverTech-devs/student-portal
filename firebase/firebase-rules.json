{
  "rules": {
    "arcade": {
      "players": {
        "$uid": {
          ".read": true,
          ".write": "auth != null && $uid === root.child('arcade/players/' + $uid + '/supabase_user_id').val()",
          ".validate": "newData.hasChildren(['supabase_user_id', 'display_name', 'created_at'])"
        }
      },
      "games": {
        "$game_id": {
          "collections": {
            "$uid": {
              ".read": "auth != null",
              ".write": "auth != null && $uid === root.child('arcade/players/' + $uid + '/supabase_user_id').val()"
            }
          },
          "decks": {
            "$uid": {
              ".read": true,
              ".write": "auth != null && $uid === root.child('arcade/players/' + $uid + '/supabase_user_id').val()",
              "$deck_id": {
                ".validate": "newData.hasChildren(['name', 'cards', 'card_count'])"
              }
            }
          },
          "stats": {
            "$uid": {
              ".read": true,
              ".write": "auth != null && $uid === root.child('arcade/players/' + $uid + '/supabase_user_id').val()"
            }
          }
        }
      },
      "matchmaking": {
        "$game_id": {
          "queue": {
            "$uid": {
              ".read": true,
              ".write": "auth != null"
            }
          },
          "lobbies": {
            "$lobby_id": {
              ".read": true,
              ".write": "auth != null"
            }
          }
        }
      },
      "matches": {
        "$game_id": {
          "$match_id": {
            ".read": true,
            ".write": "auth != null && (data.child('players/1/supabase_user_id').val() === root.child('arcade/players/' + auth.uid + '/supabase_user_id').val() || data.child('players/2/supabase_user_id').val() === root.child('arcade/players/' + auth.uid + '/supabase_user_id').val() || !data.exists())"
          }
        }
      },
      "spectating": {
        "$match_id": {
          "spectators": {
            "$uid": {
              ".read": true,
              ".write": "auth != null"
            }
          }
        }
      },
      "leaderboards": {
        ".read": true,
        ".write": false
      }
    }
  }
}
