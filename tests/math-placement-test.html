<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High School Math Placement Test</title>
    <style>
        :root {
            --bg: #0f1216;
            --card: #151a21;
            --text: #e6edf3;
            --muted: #97a2b0;
            --accent: #6aa9ff;
            --accent-2: #8bffb0;
            --danger: #ff6a6a;
            --warning: #ffd36a;
            --border: #2a3140;
            --success: #28a745;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--muted);
            font-size: 1.1rem;
        }

        .test-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        }

        .progress-container {
            margin-bottom: 30px;
        }

        .progress-bar {
            background: var(--border);
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: var(--muted);
            font-size: 0.9rem;
        }

        .question {
            margin-bottom: 30px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: var(--accent);
            color: var(--bg);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .question-category {
            background: var(--accent-2);
            color: var(--bg);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .math-expression {
            background: #1a1a2e;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            text-align: center;
            color: #d4af37;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            background: #0c1118;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: var(--accent);
            background: #151a21;
        }

        .option.selected {
            border-color: var(--accent);
            background: rgba(106, 169, 255, 0.1);
        }

        .option-letter {
            background: var(--accent);
            color: var(--bg);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .option.selected .option-letter {
            background: var(--accent-2);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: var(--bg);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(106, 169, 255, 0.3);
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #3a3a3a;
            border-color: var(--accent);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .intro-screen {
            text-align: center;
        }

        .intro-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .intro-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature {
            background: #0c1118;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .results-screen {
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0deg, var(--accent-2) 90deg, var(--border) 180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            position: relative;
        }

        .score-inner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--card);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-percentage {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
        }

        .score-label {
            font-size: 0.8rem;
            color: var(--muted);
        }

        .placement-level {
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: var(--bg);
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 20px 0;
            display: inline-block;
        }

        .breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
            text-align: left;
        }

        .breakdown-item {
            background: #0c1118;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .breakdown-category {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .breakdown-score {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .breakdown-total {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .recommendations {
            background: #0c1118;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            text-align: left;
        }

        .recommendations h3 {
            color: var(--accent-2);
            margin-bottom: 15px;
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
        }

        .recommendations li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .recommendations li:last-child {
            border-bottom: none;
        }

        .recommendations li:before {
            content: "✓";
            color: var(--accent-2);
            font-weight: bold;
            margin-right: 10px;
        }

        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .test-card {
                padding: 20px;
            }

            .question-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="timer hidden" id="timer">⏱️ <span id="time-display">30:00</span></div>

    <div class="container">
        <!-- Introduction Screen -->
        <div id="intro-screen">
            <div class="header">
                <h1>📐 High School Math Placement Test</h1>
                <p>Discover your mathematical level and get personalized recommendations</p>
            </div>

            <div class="test-card">
                <div class="intro-screen">
                    <div class="intro-content">
                        <h2>Welcome to Your Math Assessment</h2>
                        <p style="margin: 20px 0; color: var(--muted);">
                            This comprehensive test will evaluate your mathematical knowledge across multiple areas 
                            to determine the most appropriate math course placement for you.
                        </p>

                        <div class="intro-features">
                            <div class="feature">
                                <div class="feature-icon">📊</div>
                                <h3>25 Questions</h3>
                                <p>Covering arithmetic through pre-calculus</p>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">⏱️</div>
                                <h3>30 Minutes</h3>
                                <p>Timed assessment for accurate placement</p>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">🎯</div>
                                <h3>Detailed Results</h3>
                                <p>Get your placement level and recommendations</p>
                            </div>
                        </div>

                        <div style="margin: 30px 0;">
                            <h3>What You'll Need:</h3>
                            <ul style="text-align: left; max-width: 400px; margin: 15px auto;">
                                <li style="margin: 8px 0;">📝 Pencil and paper for calculations</li>
                                <li style="margin: 8px 0;">🔢 Basic calculator (if needed)</li>
                                <li style="margin: 8px 0;">🕐 Quiet environment for 30 minutes</li>
                                <li style="margin: 8px 0;">💪 Your best mathematical thinking!</li>
                            </ul>
                        </div>

                        <button class="btn btn-primary" onclick="startTest()">
                            🚀 Start Test
                        </button>
                        
                        <p style="margin-top: 15px; font-size: 0.9rem; color: var(--muted);">
                            <a href="../index.html" style="color: var(--accent);">← Back to Portal</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Screen -->
        <div id="test-screen" class="hidden">
            <div class="header">
                <h1>📐 Math Placement Test</h1>
                <p>Answer each question to the best of your ability</p>
            </div>

            <div class="test-card">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">Question 1 of 25</div>
                </div>

                <div class="question">
                    <div class="question-header">
                        <div class="question-number" id="question-number">Question 1</div>
                        <div class="question-category" id="question-category">Basic Arithmetic</div>
                    </div>
                    
                    <div class="question-text" id="question-text">
                        <!-- Question will be inserted here -->
                    </div>

                    <div class="options" id="options">
                        <!-- Options will be inserted here -->
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" id="prev-btn" onclick="previousQuestion()" disabled>
                        ← Previous
                    </button>
                    
                    <div style="text-align: center; color: var(--muted);">
                        <small>Select an answer to continue</small>
                    </div>
                    
                    <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" disabled>
                        Next →
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden">
            <div class="header">
                <h1>🎉 Test Complete!</h1>
                <p>Here are your placement results</p>
            </div>

            <div class="test-card">
                <div class="results-screen">
                    <div class="score-circle">
                        <div class="score-inner">
                            <div class="score-percentage" id="final-score">85%</div>
                            <div class="score-label">Overall Score</div>
                        </div>
                    </div>

                    <div class="placement-level" id="placement-level">
                        Algebra II Ready
                    </div>

                    <p style="margin: 20px 0; color: var(--muted);" id="placement-description">
                        Excellent work! Your results indicate you're ready for Algebra II level mathematics.
                    </p>

                    <div class="breakdown" id="score-breakdown">
                        <!-- Breakdown will be inserted here -->
                    </div>

                    <div class="recommendations" id="recommendations">
                        <!-- Recommendations will be inserted here -->
                    </div>

                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="restartTest()">
                            🔄 Retake Test
                        </button>
                        <button class="btn btn-secondary" onclick="goBackToPortal()">
                            ← Back to Portal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class MathPlacementTest {
            constructor() {
                this.currentQuestion = 0;
                this.answers = [];
                this.startTime = null;
                this.timeRemaining = 30 * 60; // 30 minutes in seconds
                this.timer = null;
                
                this.questions = [
                    // Basic Arithmetic (Questions 1-3)
                    {
                        category: "Basic Arithmetic",
                        text: "What is 24 + 37?",
                        options: ["59", "61", "71", "51"],
                        correct: 1,
                        difficulty: 1
                    },
                    {
                        category: "Basic Arithmetic", 
                        text: "What is 144 ÷ 12?",
                        options: ["11", "12", "13", "14"],
                        correct: 1,
                        difficulty: 1
                    },
                    {
                        category: "Basic Arithmetic",
                        text: "What is 15% of 80?",
                        options: ["10", "12", "15", "18"],
                        correct: 1,
                        difficulty: 1
                    },

                    // Pre-Algebra (Questions 4-6)
                    {
                        category: "Pre-Algebra",
                        text: "Solve for x: 2x + 5 = 13",
                        options: ["x = 3", "x = 4", "x = 5", "x = 6"],
                        correct: 1,
                        difficulty: 2
                    },
                    {
                        category: "Pre-Algebra",
                        text: "What is the value of 3² + 4²?",
                        options: ["25", "24", "49", "14"],
                        correct: 0,
                        difficulty: 2
                    },
                    {
                        category: "Pre-Algebra",
                        text: "If y = 2x - 3, what is y when x = 5?",
                        options: ["7", "8", "9", "10"],
                        correct: 0,
                        difficulty: 2
                    },

                    // Algebra I (Questions 7-12)
                    {
                        category: "Algebra I",
                        text: "Factor: x² + 5x + 6",
                        options: ["(x + 2)(x + 3)", "(x + 1)(x + 6)", "(x - 2)(x - 3)", "(x + 4)(x + 2)"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Algebra I",
                        text: "Solve: 3x - 7 = 2x + 5",
                        options: ["x = 12", "x = 10", "x = 8", "x = 6"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Algebra I",
                        text: "What is the slope of the line passing through (2, 3) and (6, 11)?",
                        options: ["2", "3", "4", "1/2"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Algebra I",
                        text: "Solve the system: x + y = 5, x - y = 1",
                        options: ["x = 3, y = 2", "x = 2, y = 3", "x = 4, y = 1", "x = 1, y = 4"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Algebra I",
                        text: "Simplify: (2x³)(3x²)",
                        options: ["6x⁵", "5x⁵", "6x⁶", "5x⁶"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Algebra I",
                        text: "What is the y-intercept of y = 2x - 4?",
                        options: ["-4", "2", "4", "-2"],
                        correct: 0,
                        difficulty: 3
                    },

                    // Geometry (Questions 13-16)
                    {
                        category: "Geometry",
                        text: "What is the area of a triangle with base 6 and height 8?",
                        options: ["24", "48", "14", "28"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Geometry",
                        text: "In a right triangle, if one angle is 30°, what is the third angle?",
                        options: ["60°", "50°", "45°", "70°"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Geometry",
                        text: "What is the circumference of a circle with radius 5? (Use π ≈ 3.14)",
                        options: ["31.4", "15.7", "78.5", "25"],
                        correct: 0,
                        difficulty: 3
                    },
                    {
                        category: "Geometry",
                        text: "What is the volume of a cube with side length 4?",
                        options: ["64", "48", "16", "32"],
                        correct: 0,
                        difficulty: 3
                    },

                    // Algebra II (Questions 17-21)
                    {
                        category: "Algebra II",
                        text: "Solve: x² - 5x + 6 = 0",
                        options: ["x = 2, 3", "x = 1, 6", "x = -2, -3", "x = 5, 1"],
                        correct: 0,
                        difficulty: 4
                    },
                    {
                        category: "Algebra II",
                        text: "What is log₂(8)?",
                        options: ["3", "2", "4", "6"],
                        correct: 0,
                        difficulty: 4
                    },
                    {
                        category: "Algebra II",
                        text: "Simplify: √(50)",
                        options: ["5√2", "2√5", "√50", "10"],
                        correct: 0,
                        difficulty: 4
                    },
                    {
                        category: "Algebra II",
                        text: "What is the vertex of y = x² - 4x + 3?",
                        options: ["(2, -1)", "(1, 0)", "(-2, 1)", "(4, 3)"],
                        correct: 0,
                        difficulty: 4
                    },
                    {
                        category: "Algebra II",
                        text: "If f(x) = 2ˣ, what is f(3)?",
                        options: ["8", "6", "9", "12"],
                        correct: 0,
                        difficulty: 4
                    },

                    // Pre-Calculus (Questions 22-25)
                    {
                        category: "Pre-Calculus",
                        text: "What is sin(90°)?",
                        options: ["1", "0", "√2/2", "-1"],
                        correct: 0,
                        difficulty: 5
                    },
                    {
                        category: "Pre-Calculus",
                        text: "What is the domain of f(x) = 1/(x-2)?",
                        options: ["All real numbers except x = 2", "All real numbers", "x > 2", "x < 2"],
                        correct: 0,
                        difficulty: 5
                    },
                    {
                        category: "Pre-Calculus",
                        text: "What is lim(x→3) (x² - 9)/(x - 3)?",
                        options: ["6", "3", "9", "undefined"],
                        correct: 0,
                        difficulty: 5
                    },
                    {
                        category: "Pre-Calculus",
                        text: "What is the period of y = sin(2x)?",
                        options: ["π", "2π", "π/2", "4π"],
                        correct: 0,
                        difficulty: 5
                    }
                ];
            }

            startTest() {
                document.getElementById('intro-screen').classList.add('hidden');
                document.getElementById('test-screen').classList.remove('hidden');
                document.getElementById('timer').classList.remove('hidden');
                
                this.startTime = Date.now();
                this.startTimer();
                this.displayQuestion();
            }

            startTimer() {
                this.timer = setInterval(() => {
                    this.timeRemaining--;
                    
                    const minutes = Math.floor(this.timeRemaining / 60);
                    const seconds = this.timeRemaining % 60;
                    document.getElementById('time-display').textContent = 
                        `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (this.timeRemaining <= 0) {
                        this.finishTest();
                    }
                }, 1000);
            }

            displayQuestion() {
                const question = this.questions[this.currentQuestion];
                
                document.getElementById('question-number').textContent = `Question ${this.currentQuestion + 1}`;
                document.getElementById('question-category').textContent = question.category;
                document.getElementById('question-text').textContent = question.text;
                
                const optionsContainer = document.getElementById('options');
                optionsContainer.innerHTML = '';
                
                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.onclick = () => this.selectOption(index);
                    
                    const isSelected = this.answers[this.currentQuestion] === index;
                    if (isSelected) {
                        optionElement.classList.add('selected');
                    }
                    
                    optionElement.innerHTML = `
                        <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                        <div>${option}</div>
                    `;
                    
                    optionsContainer.appendChild(optionElement);
                });
                
                this.updateProgress();
                this.updateControls();
            }

            selectOption(index) {
                this.answers[this.currentQuestion] = index;
                
                // Update visual selection
                document.querySelectorAll('.option').forEach((option, i) => {
                    option.classList.toggle('selected', i === index);
                });
                
                this.updateControls();
            }

            updateProgress() {
                const progress = ((this.currentQuestion + 1) / this.questions.length) * 100;
                document.getElementById('progress-fill').style.width = `${progress}%`;
                document.getElementById('progress-text').textContent = 
                    `Question ${this.currentQuestion + 1} of ${this.questions.length}`;
            }

            updateControls() {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                
                prevBtn.disabled = this.currentQuestion === 0;
                
                const hasAnswer = this.answers[this.currentQuestion] !== undefined;
                nextBtn.disabled = !hasAnswer;
                
                if (this.currentQuestion === this.questions.length - 1) {
                    nextBtn.textContent = hasAnswer ? 'Finish Test' : 'Select Answer';
                } else {
                    nextBtn.textContent = 'Next →';
                }
            }

            previousQuestion() {
                if (this.currentQuestion > 0) {
                    this.currentQuestion--;
                    this.displayQuestion();
                }
            }

            nextQuestion() {
                if (this.answers[this.currentQuestion] === undefined) return;
                
                if (this.currentQuestion < this.questions.length - 1) {
                    this.currentQuestion++;
                    this.displayQuestion();
                } else {
                    this.finishTest();
                }
            }

            finishTest() {
                clearInterval(this.timer);
                
                document.getElementById('test-screen').classList.add('hidden');
                document.getElementById('timer').classList.add('hidden');
                document.getElementById('results-screen').classList.remove('hidden');
                
                this.calculateResults();
            }

            calculateResults() {
                const categoryScores = {
                    'Basic Arithmetic': { correct: 0, total: 0 },
                    'Pre-Algebra': { correct: 0, total: 0 },
                    'Algebra I': { correct: 0, total: 0 },
                    'Geometry': { correct: 0, total: 0 },
                    'Algebra II': { correct: 0, total: 0 },
                    'Pre-Calculus': { correct: 0, total: 0 }
                };

                let totalCorrect = 0;
                let totalQuestions = this.questions.length;

                this.questions.forEach((question, index) => {
                    const category = question.category;
                    categoryScores[category].total++;
                    
                    if (this.answers[index] === question.correct) {
                        categoryScores[category].correct++;
                        totalCorrect++;
                    }
                });

                const overallScore = Math.round((totalCorrect / totalQuestions) * 100);
                
                // Determine placement level
                const placement = this.determinePlacement(categoryScores, overallScore);
                
                // Display results
                document.getElementById('final-score').textContent = `${overallScore}%`;
                document.getElementById('placement-level').textContent = placement.level;
                document.getElementById('placement-description').textContent = placement.description;
                
                // Display breakdown
                this.displayBreakdown(categoryScores);
                
                // Display recommendations
                this.displayRecommendations(placement, categoryScores);
            }

            determinePlacement(scores, overallScore) {
                const arithmeticPercent = scores['Basic Arithmetic'].total > 0 ? 
                    (scores['Basic Arithmetic'].correct / scores['Basic Arithmetic'].total) * 100 : 0;
                const preAlgebraPercent = scores['Pre-Algebra'].total > 0 ? 
                    (scores['Pre-Algebra'].correct / scores['Pre-Algebra'].total) * 100 : 0;
                const algebraIPercent = scores['Algebra I'].total > 0 ? 
                    (scores['Algebra I'].correct / scores['Algebra I'].total) * 100 : 0;
                const geometryPercent = scores['Geometry'].total > 0 ? 
                    (scores['Geometry'].correct / scores['Geometry'].total) * 100 : 0;
                const algebraIIPercent = scores['Algebra II'].total > 0 ? 
                    (scores['Algebra II'].correct / scores['Algebra II'].total) * 100 : 0;
                const preCalculusPercent = scores['Pre-Calculus'].total > 0 ? 
                    (scores['Pre-Calculus'].correct / scores['Pre-Calculus'].total) * 100 : 0;

                if (preCalculusPercent >= 75 && algebraIIPercent >= 80 && overallScore >= 85) {
                    return {
                        level: "AP Calculus Ready",
                        description: "Outstanding! You demonstrate mastery across all mathematical areas and are ready for Advanced Placement Calculus."
                    };
                } else if (algebraIIPercent >= 70 && geometryPercent >= 75 && overallScore >= 75) {
                    return {
                        level: "Pre-Calculus Ready", 
                        description: "Excellent work! Your strong foundation in Algebra II and Geometry prepares you for Pre-Calculus."
                    };
                } else if (algebraIPercent >= 70 && preAlgebraPercent >= 75 && overallScore >= 65) {
                    return {
                        level: "Algebra II Ready",
                        description: "Great progress! Your solid understanding of Algebra I concepts prepares you for Algebra II."
                    };
                } else if (preAlgebraPercent >= 60 && arithmeticPercent >= 70 && overallScore >= 55) {
                    return {
                        level: "Algebra I Ready",
                        description: "Good foundation! You're ready to tackle Algebra I with your strong pre-algebra skills."
                    };
                } else if (arithmeticPercent >= 60 && overallScore >= 45) {
                    return {
                        level: "Pre-Algebra Ready",
                        description: "You have the basic arithmetic skills needed for Pre-Algebra. Focus on strengthening fundamentals."
                    };
                } else {
                    return {
                        level: "Basic Math Review Recommended",
                        description: "Consider reviewing fundamental arithmetic concepts to build a stronger foundation for algebra."
                    };
                }
            }

            displayBreakdown(categoryScores) {
                const breakdown = document.getElementById('score-breakdown');
                breakdown.innerHTML = '';

                Object.entries(categoryScores).forEach(([category, scores]) => {
                    if (scores.total > 0) {
                        const percentage = Math.round((scores.correct / scores.total) * 100);
                        
                        const item = document.createElement('div');
                        item.className = 'breakdown-item';
                        item.innerHTML = `
                            <div class="breakdown-category">${category}</div>
                            <div class="breakdown-score" style="color: ${this.getScoreColor(percentage)}">${percentage}%</div>
                            <div class="breakdown-total">${scores.correct}/${scores.total} correct</div>
                        `;
                        breakdown.appendChild(item);
                    }
                });
            }

            getScoreColor(percentage) {
                if (percentage >= 80) return 'var(--accent-2)';
                if (percentage >= 70) return 'var(--warning)';
                if (percentage >= 60) return 'orange';
                return 'var(--danger)';
            }

            displayRecommendations(placement, categoryScores) {
                const recommendations = document.getElementById('recommendations');
                
                let recs = [];
                
                // Add general recommendations based on placement
                if (placement.level.includes("AP Calculus")) {
                    recs = [
                        "Enroll in AP Calculus AB or BC",
                        "Consider dual enrollment in college mathematics",
                        "Explore advanced mathematical competitions",
                        "Review limits and derivatives concepts"
                    ];
                } else if (placement.level.includes("Pre-Calculus")) {
                    recs = [
                        "Enroll in Pre-Calculus or Trigonometry",
                        "Strengthen trigonometric function knowledge",
                        "Practice with polynomial and rational functions",
                        "Review logarithmic and exponential functions"
                    ];
                } else if (placement.level.includes("Algebra II")) {
                    recs = [
                        "Enroll in Algebra II",
                        "Master quadratic equations and functions",
                        "Study polynomial operations thoroughly",
                        "Practice graphing various function types"
                    ];
                } else if (placement.level.includes("Algebra I")) {
                    recs = [
                        "Enroll in Algebra I",
                        "Focus on linear equations and inequalities",
                        "Practice factoring and solving systems",
                        "Strengthen equation-solving skills"
                    ];
                } else if (placement.level.includes("Pre-Algebra")) {
                    recs = [
                        "Enroll in Pre-Algebra",
                        "Master integer operations",
                        "Practice solving simple equations",
                        "Work with fractions and decimals"
                    ];
                } else {
                    recs = [
                        "Review basic arithmetic operations",
                        "Practice with fractions and percentages", 
                        "Strengthen number sense concepts",
                        "Consider additional tutoring support"
                    ];
                }
                
                // Add specific recommendations based on weak areas
                Object.entries(categoryScores).forEach(([category, scores]) => {
                    if (scores.total > 0) {
                        const percentage = (scores.correct / scores.total) * 100;
                        if (percentage < 60) {
                            recs.push(`Focus on strengthening ${category} concepts`);
                        }
                    }
                });

                recommendations.innerHTML = `
                    <h3>📚 Recommendations</h3>
                    <ul>
                        ${recs.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                `;
            }

            restartTest() {
                this.currentQuestion = 0;
                this.answers = [];
                this.timeRemaining = 30 * 60;
                
                document.getElementById('results-screen').classList.add('hidden');
                document.getElementById('intro-screen').classList.remove('hidden');
            }
        }

        // Global functions
        let test = new MathPlacementTest();

        function startTest() {
            test.startTest();
        }

        function nextQuestion() {
            test.nextQuestion();
        }

        function previousQuestion() {
            test.previousQuestion();
        }

        function restartTest() {
            test.restartTest();
        }

        function goBackToPortal() {
            window.location.href = '../index.html';
        }
    </script>
</body>
</html>